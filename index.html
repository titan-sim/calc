<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dino Mutant í†µí•© ì‹œë®¬ë ˆì´í„° (Dark)</title>
<style>
    :root {
      /* ê³µí†µ ë“±ê¸‰ ìƒ‰ìƒ */
      --ì¼ë°˜: #9e9e9e;
      --í¬ê·€: #4caf50;
      --ì—í”½: #ff9800;
      --ìœ ë‹ˆí¬: #eb5f0e;
      --ì „ì„¤: #ba0000;
      --primary: #2196F3;

      /* ë‹¤í¬ ëª¨ë“œ (ê¸°ë³¸) */
      --bg-color: #1a252f;
      --card-bg: #2c3e50;
      --input-bg: #3e4f5f;
      --text-main: #ffffff;
      --text-sub: #bdc3c7;
      --border-color: rgba(255, 255, 255, 0.1);
      --slot-border: #4f6272;
    }

    /* ë¼ì´íŠ¸ ëª¨ë“œ í´ë˜ìŠ¤ */
    body.light-mode {
      --bg-color: #f0f2f5;
      --card-bg: #ffffff;
      --input-bg: #f8f9fa;
      --text-main: #2c3e50;
      --text-sub: #7f8c8d;
      --border-color: rgba(0, 0, 0, 0.1);
      --slot-border: #dcdde1;
    }

    body {
      font-family: 'Pretendard', sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      padding: 20px;
      display: flex;
      justify-content: center;
      margin: 0;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: background 0.3s;
    }

    h2 {
      margin: 0 0 16px 0;
      font-size: 1rem;
      color: var(--text-main);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 18px;
    }

    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 6px;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 12px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      color: var(--text-main);
      box-sizing: border-box;
      outline: none;
      transition: background 0.3s, border 0.3s;
    }

    .full-width { grid-column: 1 / -1; }

    .slot-wrapper {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .slot {
      aspect-ratio: 1;
      border: 2px dashed var(--slot-border);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      background: var(--input-bg);
      overflow: hidden;
      transition: 0.2s;
    }

    .slot.active {
      border-color: var(--primary);
      background: rgba(33, 150, 243, 0.1);
      box-shadow: 0 0 0 2px var(--primary);
    }

    .slot-img { position: absolute; width: 100%; height: 100%; object-fit: cover; }
    .slot-lv-tag {
      position: absolute; bottom: 0; width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: #fff; font-size: 10px; text-align: center; padding: 2px 0;
    }

    #runePicker {
      display: none;
      margin-top: 20px;
      border-top: 2px solid var(--border-color);
      padding-top: 20px;
    }

    .rune-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      padding: 10px 0;
    }

    .rune-item { cursor: pointer; text-align: center; padding: 10px; }
    .rune-img-container {
      width: 60px; height: 60px; margin: 0 auto 8px;
      border-radius: 8px; overflow: hidden;
      border: 2px solid var(--slot-border);
      background: var(--bg-color);
    }
    .rune-img-container img { width: 100%; height: 100%; object-fit: cover; }
    .rune-label { font-size: 11px; font-weight: bold; color: var(--text-main); }

    #runeDetail {
      display: none; margin-top: 15px; padding: 15px;
      background: var(--input-bg); border-radius: 10px;
      border: 1px solid var(--border-color);
    }

    .desc-box {
      font-size: 13px; color: var(--text-main); margin: 10px 0;
      padding: 10px; background: var(--card-bg);
      
    }

    .btn-apply {
      width: 100%; padding: 14px; background: var(--primary);
      color: #fff; border: none; border-radius: 8px;
      font-weight: bold; cursor: pointer; margin-top: 10px;
    }

    .btn-simulate {
      width: 100%; padding: 16px; background: #e67e22;
      color: #fff; border: none; border-radius: 8px;
      font-weight: 900; cursor: pointer; margin-top: 20px; font-size: 1.1rem;
    }

    .stat-val { font-weight: bold; color: #f1c40f !important; font-size: 1.1rem; }

    .report-box {
      margin-top: 20px; padding: 15px; background: var(--bg-color);
      border-radius: 12px; border: 1px solid var(--border-color);
      display: none; line-height: 1.6;
    }

    .report-item { color: var(--text-main); font-size: 14px; margin-bottom: 5px; }
    .report-val { color: #f1c40f; font-weight: bold; float: right; }

    .app-bar {
      position: fixed; top: 0; left: 0; right: 0;
      height: 56px; background: var(--card-bg);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 16px; z-index: 1000;
      border-bottom: 1px solid var(--border-color);
      transition: background 0.3s;
    }

    .header-left { display: flex; align-items: center; gap: 12px; }
    .menu-btn { background: none; border: none; color: var(--text-main); cursor: pointer; }
    .app-title .brand { font-size: 16px; font-weight: 800; color: var(--primary); }
    .app-title .sub { font-size: 11px; color: var(--text-sub); }

    .stat-group {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 15px; margin-bottom: 10px;
    }

    .stat-row {
      display: flex; align-items: center;
      gap: 10px; font-size: 14px; color: var(--text-sub);
    }
  
  /* ì‚¬ì´ë“œë°” ì• ë‹ˆë©”ì´ì…˜ ë° ìŠ¤íƒ€ì¼ */
.side-menu {
    position: fixed;
    top: 0; left: -280px; 
    width: 280px; height: 100%;
    background: var(--card-bg);
    z-index: 2000;
    transition: 0.3s ease;
    padding: 20px;
    box-sizing: border-box;
    box-shadow: 2px 0 10px rgba(0,0,0,0.3);
}

.side-menu.open { left: 0; }

.side-header {
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 15px;
}

.menu-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    display: none; z-index: 1999;
}

.theme-toggle-btn {
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--input-bg);
    color: var(--text-main);
    cursor: pointer;
    font-size: 13px;
}
  .hp-bar-container {
    background: #444;
    border-radius: 10px;
    height: 20px;
    width: 100%;
    margin: 10px 0;
    position: relative;
    overflow: hidden;
}
.hp-bar-fill {
    background: linear-gradient(90deg, #e74c3c, #2ecc71);
    height: 100%;
    width: 0%;
    transition: width 0.5s ease;
}
.min-record-text {
    font-size: 11px;
    color: var(--text-sub);
    text-align: right;
    display: block;
    margin-top: -5px;
}

.close-btn { background: none; border: none; color: var(--text-main); font-size: 20px; cursor: pointer; }
  
  </style>
</head>

<body>

  <div id="sideMenu" class="side-menu">
    <div class="side-header">
        <span style="font-weight: bold;">ì„¤ì •</span>
        <button class="close-btn" onclick="toggleMenu()">âœ•</button>
    </div>
    <div class="menu-content" style="padding: 20px 0;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: 14px;">í…Œë§ˆ ì „í™˜</span>
            <button onclick="toggleTheme()" id="themeBtn" class="theme-toggle-btn">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
        </div>
    </div>
</div>
<div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>

<header class="app-bar">
    <div class="header-left">
        <button class="menu-btn" onclick="toggleMenu()"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
            </svg>
        </button>
        <div class="app-title">
            <span class="brand">DINO MUTANT</span>
            <span class="sub">íƒ€ì´íƒ„ ì‹œë®¬ë ˆì´í„°</span>
        </div>
    </div>
</header>

  <div class="container" style="margin-top: 60px;">
    <div class="warning" style="text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 15px; margin-bottom: 5px;">
      â€» ë³¸ ì‹œë®¬ë ˆì´í„°ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ì—°ì‚° ë°©ì‹ê³¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>
    <div class="card">
      <h2>ë‚´ ê³µë£¡ ì •ë³´</h2>
      <div class="input-grid">
<div>
  <label>ê¸°ë³¸ ê³µê²©ë ¥</label>
  <input type="tel" id="baseAtk" value="1" 
         oninput="this.value = this.value.replace(/[^0-9]/g, ''); calcFinal();" 
         onblur="if(this.value === '' || Number(this.value) < 1) this.value = 1; calcFinal();" 
         onfocus="this.select()" placeholder="ìµœì†Œì¹˜ 1">
</div>

<div>
  <label>ê¸°ë³¸ ì²´ë ¥</label>
  <input type="tel" id="baseHp" value="10" 
         oninput="this.value = this.value.replace(/[^0-9]/g, ''); calcFinal();" 
         onblur="if(this.value === '' || Number(this.value) < 10) this.value = 10; calcFinal();" 
         onfocus="this.select()" placeholder="ìµœì†Œì¹˜ 10">
</div>
        <div class="full-width">
          <label>ê³µë£¡ ìˆ˜</label>
          <select id="dinoCount" onchange="calcFinal()"></select>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ì „íˆ¬ ì„¤ì •</h2>
      <div class="input-grid">
        <div class="full-width">
          <label>íƒ€ì´íƒ„ ë ˆë²¨ ì„ íƒ</label>
          <select id="titanLevelSelect" onchange="saveUserConfig()"></select>
        </div>
        <div class="full-width">
          <label>ì „íˆ¬ ì œí•œ ì‹œê°„</label>
          <select id="timeLimitSelect" onchange="saveUserConfig()"></select>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ì¥ì°©ëœ ë£¬</h2>
      <div class="slot-wrapper" id="slotContainer"></div>
      <div id="runePicker">
        <div>
          <div class="rune-grid" id="mainGrid"></div>
          <div class="divider" style="grid-column: 1/-1; text-align: center; color: #e74c3c; font-size: 12px; padding: 15px 0;">â”€â”€ ë¶€ì í•© ë£¬ â”€â”€</div>
          <div class="rune-grid" id="unsuitableGrid"></div>
        </div>
        <div id="runeDetail">
          <div id="detailGrade" style="font-size:11px; font-weight:bold;"></div>
          <h3 id="detailName" style="margin:5px 0;"></h3>
          <div id="levelArea">
            <label>ë£¬ ë ˆë²¨</label>
            <select id="levelSelect"></select>
            <div class="desc-box" id="detailDesc"></div>
          </div>
          <button class="btn-apply" id="applyBtn" onclick="applyRuneToSlot()">ìŠ¬ë¡¯ì— ì¥ì°©</button>
          <button class="btn-apply" id="removeBtn" onclick="removeRuneFromSlot()" style="background:#7f8c8d; margin-top:5px;">ì¥ì°© í•´ì œ</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ì‹¤ì‹œê°„ ì „íˆ¬ ì‹œë®¬ë ˆì´ì…˜</h2>
      <div class="stat-group">
        <div class="stat-row">ìµœì¢… ê³µê²©ë ¥: <span class="stat-val" id="resAtk">0</span></div>
        <div class="stat-row">ìµœì¢… ì²´ë ¥: <span class="stat-val" id="resHp">0</span></div>
      </div>

      <button class="btn-simulate" onclick="startSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ âš”ï¸</button>

     <div id="battleReport" class="report-box">
  <div class="report-item">ì´ ì…íŒ í”¼í•´ëŸ‰ <span class="report-val" id="repTotalDmg">0</span></div>
  <div class="report-item">ë‚¨ì€ íƒ€ì´íƒ„ ì²´ë ¥ <span class="report-val" id="repTitanHp">0</span></div>
  <div class="report-item">í‰ê·  ì „íˆ¬ ì‹œê°„ <span class="report-val" id="repTime">0</span></div>
  <div class="report-item">í‰ê·  ì „ì‚¬ ê³µë£¡ <span class="report-val" id="repDead">0</span></div>
  
  <div style="margin-top:15px; border-top:1px solid var(--border-color); padding-top:15px;">
    <div class="report-item">ê³µë£¡ ì²´ë ¥ í‰ê· : <span class="report-val" id="avgMinHpPer">0%</span></div>
    <div class="hp-bar-container">
      <div id="hpBarFill" class="hp-bar-fill"></div>
  </div>
</div>
    </div>
  </div>

  <script>
    function toggleMenu() {
    const menu = document.getElementById('sideMenu');
    const overlay = document.getElementById('menuOverlay');
    const isOpen = menu.classList.toggle('open');
    overlay.style.display = isOpen ? 'block' : 'none';
}

function toggleTheme() {
    const isLight = document.body.classList.toggle('light-mode');
    const themeBtn = document.getElementById('themeBtn');
    themeBtn.innerText = isLight ? 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
    localStorage.setItem('dino_theme', isLight ? 'light' : 'dark');
}

window.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('dino_theme') === 'light') {
        document.body.classList.add('light-mode');
        const themeBtn = document.getElementById('themeBtn');
        if(themeBtn) themeBtn.innerText = 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
    }
});
    // ë£¬ ë°ì´í„° ì˜ì—­ (ì´ê³³ì— ìˆ˜ì •í•˜ì‹  ë£¬ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”)
    const RUNES_DATA = {
      "í": {
        grade: "ì¼ë°˜",
        imgId: "1ihowBMqeNvWag_4ou2JLgYilpLGvgnPa",
        desc: "ê³µê²©ë‹¹í•  ë•Œ {prob}% í™•ë¥ ë¡œ ìµœëŒ€ ì²´ë ¥ì˜ {value}% íšŒë³µ",
        levels: (function() {
          let lv = {};
          const p = [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 13];
          const v = [1, 1.1, 1.2, 1.3, 1.4, 2, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.5, 3.6, 3.7, 3.8, 3.9, 4, 4.1, 4.2, 4.3, 4.4, 5, 5.1, 5.2, 5.3, 5.4, 8];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ê³µê²©ë ¥ ì¦ê°€ 1": {
        grade: "ì¼ë°˜",
        imgId: "1ihowBMqeNvWag_4ou2JLgYilpLGvgnPa",
        desc: "ê³µê²©ë ¥ {atk_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: i
          };
          return lv;
        })()
      },
      "ì²´ë ¥ ì¦ê°€ 1": {
        grade: "ì¼ë°˜",
        imgId: "1vNpdtLIozfnNOhjl2-gIMFH33xLmgh3P",
        desc: "ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            hp_f: i * 25
          };
          return lv;
        })()
      },
      "í¬ìƒ": {
        grade: "ì¼ë°˜",
        imgId: "1Yuy6PLeo7Jx-fAef04PVuqmiZjR_mw64",
        desc: "ì‚¬ë§ ì‹œ {prob}% í™•ë¥ ë¡œ ì•„êµ° ì²´ë ¥ {value}% íšŒë³µ",
        levels: (function() {
          let lv = {};
          const p = [35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 50];
          const v = [10, 10.5, 11, 11.5, 12, 15, 15.5, 16, 16.5, 17, 20, 20.5, 21, 21.5, 22, 25, 25.5, 26, 26.5, 27, 30, 30.5, 31, 31.5, 32, 35, 35.5, 36, 36.5, 37, 45];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ë§ˆì§€ë§‰ ì„ ë¬¼": {
        grade: "ì¼ë°˜",
        imgId: "16X52VhA2_Z-UFH6bNFdqA_XkXwPdWZJg",
        desc: "ì‚¬ë§ ì‹œ {prob}% í™•ë¥ ë¡œ ê³µê²©ë ¥ {atk_p}% ë²„í”„ ({turn}í„´)",
        levels: (function() {
          let lv = {};
          const p = [40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 60];
          const t = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4];
          for (let i = 1; i <= 31; i++) lv[i] = {
            prob: p[i - 1],
            atk_p: 14 + i,
            turn: t[i - 1]
          };
          return lv;
        })()
      },
      "íŠ¸ë¦¬í”Œ ì„íŒ©íŠ¸": {
        grade: "ì¼ë°˜",
        imgId: "1nO4CtfdB_FH7ZvCmL3uj1QPLDJte5mLB",
        desc: "3ë²ˆì§¸ ê³µê²©ë§ˆë‹¤ ê³µê²©ë ¥ì˜ {value}% ì¶”ê°€ í”¼í•´",
        levels: (function() {
          let lv = {};
          const v = [2, 2.5, 3, 3.5, 4, 6, 6.5, 7, 7.5, 8, 10, 10.5, 11, 11.5, 12, 14, 14.5, 15, 15.5, 16, 18, 18.5, 19, 19.5, 20, 22, 22.5, 23, 23.5, 24, 27];
          v.forEach((x, i) => lv[i + 1] = {
            value: x
          });
          return lv;
        })()
      },
      "ë‹¨ë‹¨í•œ í”¼ë¶€ 1": {
        grade: "ì¼ë°˜",
        imgId: "1oHu7Ep7BwL7Es4dBRVdTyfnSrfd_xIq1",
        desc: "í”¼í•´ {value} ê°ì†Œ",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            value: i * 2
          };
          return lv;
        })()
      },
      "í”¼í•´ ì €í•­ 1": {
        grade: "ì¼ë°˜",
        imgId: "1tBCAdO-UyCTP32gHwEc7TVISeRINsrqa",
        desc: "{prob}% í™•ë¥ ë¡œ í”¼í•´ {value} ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const p = [30, 30, 30, 30, 30, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 50];
          const v = [30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ë³´í˜¸ë§‰": {
        grade: "ì¼ë°˜",
        imgId: "1-FCajygUymZcpCCxaK7_Scg5NtiPKyiM",
        desc: "{turn}ë²ˆì˜ ê³µê²© í”¼í•´ë¥¼ {value}% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const t = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3];
          const v = [1, 1.5, 2, 2.5, 3, 5, 5.5, 6, 6.5, 7, 10, 10.5, 11, 11.5, 12, 13, 13.5, 14, 14.5, 15, 18, 18.5, 19, 19.5, 20, 22, 22.5, 23, 23.5, 24, 28];
          t.forEach((x, i) => lv[i + 1] = {
            turn: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ê³µê²©ë ¥ ì¦ê°€ 2": {
        grade: "í¬ê·€",
        imgId: "1PKky7_H1ZXJNxzZJhByTw7hUclQ0aTRG",
        desc: "ê³µê²©ë ¥ {atk_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: 15 + i - 1
          };
          return lv;
        })()
      },
      "ì²´ë ¥ ì¦ê°€ 2": {
        grade: "í¬ê·€",
        imgId: "1oIkxrSL3mVZo-fHXOv2Ot2Zmmftwpp3H",
        desc: "ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            hp_f: 375 + (i - 1) * 25
          };
          return lv;
        })()
      },
      "í˜‘ë™ ê³µê²©": {
        grade: "í¬ê·€",
        imgId: "1DzFWPRILgHZAF28JrzUzKZQWKCtAN2vR",
        desc: "5ë§ˆë¦¬ ì´ìƒì¼ ë•Œ ê³µê²©ë ¥ {atk_f}, ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          const a = [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 62, 64, 66, 68, 75];
          const h = [875, 900, 925, 950, 975, 1000, 1025, 1050, 1075, 1100, 1125, 1150, 1175, 1200, 1225, 1250, 1275, 1300, 1325, 1350, 1375, 1400, 1425, 1450, 1475, 1500, 1550, 1600, 1650, 1700, 1875];
          a.forEach((x, i) => lv[i + 1] = {
            atk_f: x,
            hp_f: h[i]
          });
          return lv;
        })()
      },
      "ê³ ë…í•œ ë¶„ë…¸": {
        grade: "í¬ê·€",
        imgId: "1hAyyAwatFwvlKqth4sunU_gURWoTY4ZJ",
        desc: "1ë§ˆë¦¬ì¼ ë•Œ ê³µê²©ë ¥ {atk_f}, ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: 15 + i - 1,
            hp_f: 375 + (i - 1) * 25
          };
          return lv;
        })()
      },
      "ë‹¨ë‹¨í•œ í”¼ë¶€ 2": {
        grade: "í¬ê·€",
        imgId: "1XfdIrPSz_xm9v1KHB-TArpaRdv47zHLF",
        desc: "í”¼í•´ {value} ê°ì†Œ",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            value: 30 + (i - 1) * 2
          };
          return lv;
        })()
      },
      "í”¼í•´ ì €í•­ 2": {
        grade: "í¬ê·€",
        imgId: "13As5kbKRnyJA81fUClKxILhq8P9Rws0c",
        desc: "{prob}% í™•ë¥ ë¡œ í”¼í•´ {value} ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const p = [30, 30, 30, 30, 30, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 50];
          const v = [70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 124, 128, 132, 136, 150];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ì¹˜ëª…íƒ€ í™•ë¥ ": {
        grade: "ì—í”½",
        imgId: "1rZUa6JfGfbksXt1qOO32veoEty9er_Bu",
        desc: "ì¹˜ëª…íƒ€ í™•ë¥  {value}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [13, 13.3, 13.6, 13.9, 14.2, 17, 17.3, 17.6, 17.9, 18.2, 21, 21.3, 21.6, 21.9, 22.2, 25, 25.5, 26, 26.5, 27, 30, 30.5, 31, 31.5, 32, 35, 35.5, 36, 36.5, 37, 40];
          v.forEach((x, i) => lv[i + 1] = {
            value: x
          });
          return lv;
        })()
      },
      "ì¹˜ëª…íƒ€ í”¼í•´": {
        grade: "ì—í”½",
        imgId: "127l8ExJLlQENOySkwk_TiNDLO5gKo7Rm",
        desc: "ì¹˜ëª…íƒ€ í”¼í•´ëŸ‰ {value}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [20, 20.5, 21, 21.5, 22, 25, 25.5, 26, 26.5, 27, 30, 30.5, 31, 31.5, 32, 35, 36, 37, 38, 39, 42, 43, 44, 45, 46, 50, 51, 52, 53, 54, 60];
          v.forEach((x, i) => lv[i + 1] = {
            value: x
          });
          return lv;
        })()
      },
      "ê³µê²©ë ¥ ì¦ê°€ 3": {
        grade: "ì—í”½",
        imgId: "1MBbzM8Snw4awmVoS-mBe1ATN_WlkcwqL",
        desc: "ê³µê²©ë ¥ {atk_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 62, 64, 66, 68, 75];
          v.forEach((x, i) => lv[i + 1] = {
            atk_f: x
          });
          return lv;
        })()
      },
      "ì²´ë ¥ ì¦ê°€ 3": {
        grade: "ì—í”½",
        imgId: "1r_tPl7V2ydsAD3p_amPfL1d92i-6AFLN",
        desc: "ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [875, 900, 925, 950, 975, 1000, 1025, 1050, 1075, 1100, 1125, 1150, 1175, 1200, 1225, 1250, 1275, 1300, 1325, 1350, 1375, 1400, 1425, 1450, 1475, 1500, 1550, 1600, 1650, 1700, 1875];
          v.forEach((x, i) => lv[i + 1] = {
            hp_f: x
          });
          return lv;
        })()
      },
      "ì£½ì„ ì¤€ë¹„": {
        grade: "ì—í”½",
        imgId: "1x77384PZAogZ_hTJeRH1iLXPrOfM5e_g",
        desc: "ì‚¬ë§ ì‹œ {prob}% í™•ë¥ ë¡œ ê³µê²©ë ¥ì˜ {value}% í”¼í•´",
        levels: (function() {
          let lv = {};
          const p = [80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 100];
          const v = [50, 51, 52, 53, 54, 60, 61, 62, 63, 64, 66, 67, 68, 69, 70, 76, 77, 78, 79, 80, 82, 83, 84, 85, 86, 90, 91, 92, 93, 94, 100];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ì••ì¶•ëœ í˜": {
        grade: "ì—í”½",
        imgId: "1aaijjlcR-GjrDeZy4WzBqFN2J7oBiw2C",
        desc: "ê³µê²©ë ¥ {atk_p}% ì¦ê°€, ì²´ë ¥ {hp_p}% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const v = [15, 15.2, 15.4, 15.6, 15.8, 17, 17.5, 18, 18.5, 19, 22, 22.5, 23, 23.5, 24, 27, 27.5, 28, 28.5, 29, 33, 33.5, 34, 34.5, 35, 39, 39.5, 40, 40.5, 41, 45];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x,
            hp_p: -25
          });
          return lv;
        })()
      },
      "ë©”ë¨¸ë“œì˜ í˜": {
        grade: "ì—í”½",
        imgId: "14UVrJVEIr5xZghRiG96doS_QhOQ0VxBK",
        desc: "ì²´ë ¥ {hp_p}% ì¦ê°€, ê³µê²©ë ¥ {atk_p}% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const v = [19.5, 20, 20.5, 21, 21.5, 27, 27.5, 28, 28.5, 29, 34.5, 35.5, 36.5, 37.5, 38.5, 44.5, 45.8, 47, 48.3, 49.5, 59.5, 60.8, 62, 63.3, 64.5, 79.5, 80.8, 82, 83.3, 84.5, 102];
          v.forEach((x, i) => lv[i + 1] = {
            hp_p: x,
            atk_p: -25
          });
          return lv;
        })()
      },
      "í¡í˜ˆ": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1wpM4jrjnyShM9jkrWQuleCMRQzqajRg-",
        desc: "{prob}% í™•ë¥ ë¡œ ê³µê²©ë ¥ì˜ {value}% íšŒë³µ",
        levels: (function() {
          let lv = {};
          const p = [15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 30];
          const v = [30, 32, 34, 36, 38, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 95, 97, 99, 101, 103, 110];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i]
          });
          return lv;
        })()
      },
      "ê°•íƒ€": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1duFRCFWSfwJIT4FcOfDcJU5t9_sYYSNd",
        desc: "ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [7, 7.2, 7.4, 7.6, 7.8, 10, 10.2, 10.4, 10.6, 10.8, 13, 13.4, 13.8, 14.2, 14.6, 17, 17.5, 18, 18.5, 19, 23, 23.5, 24, 24.5, 25, 31, 31.5, 32, 32.5, 33, 40];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x
          });
          return lv;
        })()
      },
      "ë°©ì–´ë²½": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "19nNX-o2m8lDQfKLe5YXd7JijVf7HK0iI",
        desc: "ì²´ë ¥ {hp_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [17.5, 18, 18.5, 19, 19.5, 25, 25.5, 26, 26.5, 27, 32.5, 33.5, 34.5, 35.5, 36.5, 42.5, 43.8, 45, 46.3, 47.5, 57.5, 58.8, 60, 61.3, 62.5, 77.5, 78.8, 80, 81.3, 82.5, 100];
          v.forEach((x, i) => lv[i + 1] = {
            hp_p: x
          });
          return lv;
        })()
      },
      "ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1UaNaWoiuUASIRx62ixYoUTleH-wc_gFI",
        desc: "ë³´ìŠ¤ ê³µê²© ì‹œ ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [20, 22, 24, 26, 28, 40, 42, 44, 46, 48, 60, 62, 64, 66, 68, 80, 83, 86, 89, 92, 110, 115, 120, 125, 130, 150, 160, 170, 180, 190, 250];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x
          });
          return lv;
        })()
      },
      "ë©”í…Œì˜¤": {
        grade: "ì „ì„¤",
        imgId: "1fJVyoKiTVH1i0votjXaXuwAbTZjxnM-P",
        desc: "{prob}% í™•ë¥ ë¡œ ë²”ìœ„ í”¼í•´ {value}%\n[íŒ¨ì‹œë¸Œ] ê³µ/ì²´ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const p = [50, 50, 50, 50, 50, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 60, 60, 60, 60, 60, 65];
          const v = [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 40, 41, 42, 43, 44, 50, 51, 52, 53, 54, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 80];
          const pas = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 10];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i],
            atk_p: pas[i],
            hp_p: pas[i]
          });
          return lv;
        })()
      },
      "ë‚™ë¢°": {
        grade: "ì „ì„¤",
        imgId: "1pPUwyTblvZJDbTAPUOJYr8hdUqPTZmy4",
        desc: "{prob}% í™•ë¥ ë¡œ ì¶”ê°€ í”¼í•´ {value}%\n[íŒ¨ì‹œë¸Œ] ê³µ/ì²´ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const p = [40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 60, 60, 60, 60, 60, 65, 65, 65, 65, 65, 65];
          const v = [40, 40.5, 41, 41.5, 42, 50, 50.5, 51, 51.5, 52, 67.5, 68, 68.5, 69, 69.5, 82.5, 83, 83.5, 84, 84.5, 90, 90.5, 91, 91.5, 92, 100, 100.5, 101, 101.5, 102, 115];
          const pas = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 10];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            value: v[i],
            atk_p: pas[i],
            hp_p: pas[i]
          });
          return lv;
        })()
      },
      // ë¶€ì í•© ë£¬ ëª©ë¡ (ë°ì´í„° ì—†ìŒ)
      "ìŠ¹ë¦¬ì˜ í•¨ì„±": {
        grade: "ì¼ë°˜",
        imgId: "1kdYTPMnC9sHD_xVfJ7KlMEAmepKrI5U3",
        levels: {}
      },
      "ìì—°ì˜ í¬ì˜¹": {
        grade: "ì¼ë°˜",
        imgId: "11shDd_9139ob8f3NJpu51kASPqzfDZTF",
        levels: {}
      },
      "íŒŒê´´ì 1": {
        grade: "ì¼ë°˜",
        imgId: "1gEKQmAPtu3APq91BSK7YlUldIkPQQKV3",
        levels: {}
      },
      "ê°•ì¸í•¨ 1": {
        grade: "ì¼ë°˜",
        imgId: "1USRrGEG4SiMnOwYYV_IYy0hllT6fXNhN",
        levels: {}
      },
      "ë¶€ì¡±ì˜ ì¶•ë³µ 1": {
        grade: "ì¼ë°˜",
        imgId: "19K30pdy48M0_TW7kR5Iz8Cxbx5NxYVkX",
        levels: {}
      },
      "íŒŒê´´ì 2": {
        grade: "í¬ê·€",
        imgId: "1XWpJQ3PShBg43fHvfVgf1f8t0pDoD5mj",
        levels: {}
      },
      "ë¶€ì¡±ì˜ ì¶•ë³µ 2": {
        grade: "í¬ê·€",
        imgId: "1EIJibIbgJ2EXyMhJT59cSWNACb-ROxxv",
        levels: {}
      },
      "íŒŒê´´ì 3": {
        grade: "ì—í”½",
        imgId: "1sSwqcPHGFhZIR1i-UfwHuU34NvvDPwN2",
        levels: {}
      },
      "ê°•ì¸í•¨ 2": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "12R07txrHKhMhwoxbE4M-QBw4mxxOUTxf",
        levels: {}
      },
      "ì§€ì§„": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1qH0wEmw_otlxQBBofd-H4kuA2SMKIVKn",
        levels: {}
      }
    };
    const titanStats = [];
    const unsuitableList = ["ê°•ì¸í•¨ 1", "ê°•ì¸í•¨ 2", "ìì—°ì˜ í¬ì˜¹", "ìŠ¹ë¦¬ì˜ í•¨ì„±", "ë¶€ì¡±ì˜ ì¶•ë³µ 1", "ë¶€ì¡±ì˜ ì¶•ë³µ 2", "íŒŒê´´ì 1", "íŒŒê´´ì 2", "íŒŒê´´ì 3", "ì§€ì§„"];
    const vampExclusion = ["ê³ ë…í•œ ë¶„ë…¸", "í˜‘ë™ ê³µê²©", "ë§ˆì§€ë§‰ ì„ ë¬¼", "ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´"];
    let selectedRunes = [null, null, null, null, null];
    let activeSlotIdx = null;
    let tempName = "";
    // ëª¨ë“  ì„¤ì •ê°’ ì €ì¥ í•¨ìˆ˜
function saveUserConfig() {
    const config = {
        baseAtk: document.getElementById('baseAtk').value,
        baseHp: document.getElementById('baseHp').value,
        dinoCount: document.getElementById('dinoCount').value,
        titanLevel: document.getElementById('titanLevelSelect').value,
        timeLimit: document.getElementById('timeLimitSelect').value,
        selectedRunes: selectedRunes // [ {name, lv}, ... ]
    };
    localStorage.setItem('dino_sim_config', JSON.stringify(config));
}

// ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
function loadUserConfig() {
    const saved = localStorage.getItem('dino_sim_config');
    if (!saved) return;

    const config = JSON.parse(saved);

    // ê¸°ë³¸ ì •ë³´ ë³µêµ¬
    document.getElementById('baseAtk').value = config.baseAtk;
    document.getElementById('baseHp').value = config.baseHp;
    document.getElementById('dinoCount').value = config.dinoCount;
    document.getElementById('titanLevelSelect').value = config.titanLevel;
    document.getElementById('timeLimitSelect').value = config.timeLimit;

    // ë£¬ ìŠ¬ë¡¯ ë³µêµ¬
    if (config.selectedRunes) {
        selectedRunes = config.selectedRunes;
        selectedRunes.forEach((rune, idx) => {
            const slot = document.getElementById(`slot-${idx}`);
            if (rune && rune.name && RUNES_DATA[rune.name]) {
                slot.innerHTML = `
                    <img src="${getImgUrl(RUNES_DATA[rune.name].imgId)}" class="slot-img">
                    <div class="slot-lv-tag">Lv.${rune.lv}</div>`;
            } else {
                slot.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${idx+1}</span>`;
            }
        });
    }
    calcFinal(); // í™”ë©´ ìŠ¤íƒ¯ ê°±ì‹ 
}
    window.onload = () => {
      // íƒ€ì´íƒ„ ë°ì´í„° ìƒì„± (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
      for (let lv = 1; lv <= 39; lv++) {
        let atk, hp;
        const baseHps = [2500000, 5000000, 7500000, 10000000, 13125000, 16875000, 20625000, 24375000, 28125000, 31875000];
        if (lv <= 10) {
          atk = lv * 5;
          hp = baseHps[lv - 1];
        } else {
          atk = 90 + (lv - 10) * 15;
          hp = 31875000 + (lv - 10) * 3750000;
        }
        titanStats[lv] = {
          atk,
          hp
        };
        const opt = new Option(`Lv.${lv} (ATK ${atk} / HP ${hp.toLocaleString()})`, lv);
        document.getElementById('titanLevelSelect').add(opt);
      }
      const timeSelect = document.getElementById('timeLimitSelect');
      for (let m = 10; m <= 120; m += 10) timeSelect.add(new Option(`${m}ë¶„`, m));
      const dCount = document.getElementById('dinoCount');
      for (let i = 1; i <= 9; i++) dCount.add(new Option(`${i}ë§ˆë¦¬`, i));
      const sc = document.getElementById('slotContainer');
      for (let i = 0; i < 5; i++) {
        const div = document.createElement('div');
        div.className = 'slot';
        div.id = `slot-${i}`;
        div.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${i+1}</span>`;
        div.onclick = () => openPicker(i);
        sc.appendChild(div);
      }
      const mainGrid = document.getElementById('mainGrid');
      const unsuitableGrid = document.getElementById('unsuitableGrid');
      Object.keys(RUNES_DATA).forEach(name => {
        const r = RUNES_DATA[name];
        const isUn = unsuitableList.includes(name);
        const item = document.createElement('div');
        item.className = 'rune-item';
        item.innerHTML = `<div class="rune-img-container" style="border-color:var(--${r.grade})"><img src="${getImgUrl(r.imgId)}"></div><div class="rune-label">${name}</div>`;
        item.onclick = () => showDetail(name);
        if (isUn) unsuitableGrid.appendChild(item);
        else mainGrid.appendChild(item);
      });
      const ls = document.getElementById('levelSelect');
      for (let i = 1; i <= 31; i++) ls.add(new Option(`Lv.${i}`, i));
      ls.onchange = () => updateDetail(tempName, ls.value);
      loadUserConfig();
    };

    function openPicker(idx) {
      const picker = document.getElementById('runePicker');
      const isSameSlot = (activeSlotIdx === idx); // í˜„ì¬ í´ë¦­í•œ ê²Œ ì´ë¯¸ ì—´ë¦° ìŠ¬ë¡¯ì¸ì§€ í™•ì¸
      // 1. ê°™ì€ ìŠ¬ë¡¯ì„ ë˜ ëˆŒë €ê³ , ì´ë¯¸ ì°½ì´ ì—´ë ¤ìˆë‹¤ë©´ ë‹«ê¸°
      if (isSameSlot && picker.style.display === 'block') {
        picker.style.display = 'none';
        activeSlotIdx = null;
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
      }
      // 2. ì°½ì´ ë‹«í˜€ìˆê±°ë‚˜ ë‹¤ë¥¸ ìŠ¬ë¡¯ì„ ëˆŒë €ë‹¤ë©´ ì—´ê¸°
      else {
        activeSlotIdx = idx;
        picker.style.display = 'block';
        document.querySelectorAll('.slot').forEach((s, i) => {
          s.classList.toggle('active', i === idx);
        });
        // ì°½ì´ ì—´ë¦´ ë•Œ ë£¬ ê·¸ë¦¬ë“œ ì‹œì‘ ì§€ì ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™ (ì„ íƒ ì‚¬í•­)
        picker.scrollIntoView({
          behavior: 'smooth',
          block: 'nearest'
        });
      }
    }

    function showDetail(name) {
      tempName = name;
      const r = RUNES_DATA[name];
      document.getElementById('runeDetail').style.display = 'block';
      document.getElementById('detailName').innerText = name;
      document.getElementById('detailGrade').innerText = r.grade;
      document.getElementById('detailGrade').style.color = `var(--${r.grade})`;
      updateDetail(name, document.getElementById('levelSelect').value);
    }

    function updateDetail(name, lv) {
      const r = RUNES_DATA[name];
      const s = r.levels[lv];
      let d = r.desc || "";
      if (s) Object.keys(s).forEach(k => {
        const regex = new RegExp(`{${k}}`, "g");
        d = d.replace(regex, `<b>${s[k]}</b>`);
      });
      document.getElementById('detailDesc').innerHTML = d;
    }
    // 1. ì¤‘ë³µ ì²´í¬ ë° ì¥ì°© ë¡œì§
function applyRuneToSlot() {
    const lv = document.getElementById('levelSelect').value;
    const slot = document.getElementById(`slot-${activeSlotIdx}`);

    // ë™ì¼ ë£¬ì´ ì´ë¯¸ ë‹¤ë¥¸ ìŠ¬ë¡¯ì— ìˆëŠ”ì§€ ì²´í¬í•˜ì—¬ ì œê±°
    selectedRunes.forEach((rune, idx) => {
        if (rune && rune.name === tempName) {
            selectedRunes[idx] = null;
            const otherSlot = document.getElementById(`slot-${idx}`);
            // ì•ˆì „í•˜ê²Œ í…ìŠ¤íŠ¸ë¡œ ì´ˆê¸°í™”
            otherSlot.textContent = ''; 
            otherSlot.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${idx+1}</span>`;
        }
    });

    // ë°ì´í„° ì €ì¥
    selectedRunes[activeSlotIdx] = { name: tempName, lv: lv };

    // DOM ì—…ë°ì´íŠ¸: ì•ˆì „í•˜ê²Œ ë¹„ìš°ê³  ì‚½ì…
    slot.textContent = ''; 
    slot.innerHTML = `
        <img src="${getImgUrl(RUNES_DATA[tempName].imgId)}" class="slot-img">
        <div class="slot-lv-tag">Lv.${lv}</div>`;

    document.getElementById('runePicker').style.display = 'none';
    calcFinal();
    saveUserConfig();
}
    // 2. ì¥ì°© í•´ì œ ë¡œì§
function removeRuneFromSlot() {
    if (activeSlotIdx === null) return;

    selectedRunes[activeSlotIdx] = null;
    const slot = document.getElementById(`slot-${activeSlotIdx}`);
    
    // ì•ˆì „í•˜ê²Œ ë¹„ìš°ê³  ê¸°ë³¸ í…ìŠ¤íŠ¸ ì‚½ì…
    slot.textContent = '';
    slot.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${activeSlotIdx+1}</span>`;
    
    document.getElementById('runePicker').style.display = 'none';
    calcFinal();
    saveUserConfig();
}
    // 3. ìƒì„¸ ì •ë³´ í‘œì‹œ ë° ìë™ ìŠ¤í¬ë¡¤
    function showDetail(name) {
      tempName = name;
      const r = RUNES_DATA[name];
      const detailView = document.getElementById('runeDetail');
      detailView.style.display = 'block';
      document.getElementById('detailName').innerText = name;
      document.getElementById('detailGrade').innerText = r.grade;
      document.getElementById('detailGrade').style.color = `var(--${r.grade})`;
      updateDetail(name, document.getElementById('levelSelect').value);
      // í•˜ë‹¨ ìƒì„¸ì°½ìœ¼ë¡œ ìë™ ìŠ¤í¬ë¡¤
      detailView.scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
      });
    }
    // ì „íˆ¬ ìŠ¤íƒ¯ ê³„ì‚° (ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´ ë° ì •ìˆ˜/í¼ì„¼íŠ¸ í•©ì‚°)
    function getBattleStats() {
      const bAtk = Number(document.getElementById('baseAtk').value);
      const bHp = Number(document.getElementById('baseHp').value);
      const count = Number(document.getElementById('dinoCount').value);
      let atkF = 0,
        atkP = 0,
        hpF = 0,
        hpP = 0,
        cRate = 0,
        cDmg = 100;
      selectedRunes.forEach(r => {
        if (!r) return;
        const s = RUNES_DATA[r.name].levels[r.lv];
        let active = (r.name === "í˜‘ë™ ê³µê²©" ? count >= 5 : (r.name === "ê³ ë…í•œ ë¶„ë…¸" ? count === 1 : true));
        if (active) {
          if (s.atk_f) atkF += s.atk_f;
          if (s.atk_p) atkP += s.atk_p;
          if (s.hp_f) hpF += s.hp_f;
          if (s.hp_p) hpP += s.hp_p;
          // ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´ëŠ” atk_pë¡œ ë°ì´í„°ë¥¼ ê³ ì³¤ìœ¼ë¯€ë¡œ ìœ„ ë¡œì§ì—ì„œ ìë™ í•©ì‚°ë¨
        }
        if (r.name === "ì¹˜ëª…íƒ€ í™•ë¥ ") cRate += s.value;
        if (r.name === "ì¹˜ëª…íƒ€ í”¼í•´") cDmg += s.value;
      });
      return {
        fAtk: (bAtk + atkF) * (1 + atkP / 100),
        fHp: (bHp + hpF) * (1 + hpP / 100),
        cRate,
        cDmg
      };
    }

    function calcFinal() {
      const s = getBattleStats();
      document.getElementById('resAtk').innerText = Math.floor(s.fAtk).toLocaleString();
      document.getElementById('resHp').innerText = Math.floor(s.fHp).toLocaleString();
      saveUserConfig();
    }
    // ... (í—¤ë” ë° ìŠ¤íƒ€ì¼ ë™ì¼) ...
    /* ... (ìœ„ìª½ íƒ€ì´íƒ„ ë°ì´í„° ìƒì„± ë° ê¸°ë³¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ë™ì¼) ... */
    // ì‹œë®¬ë ˆì´ì…˜ í•µì‹¬ í•¨ìˆ˜
// ì‹œë®¬ë ˆì´ì…˜ í•µì‹¬ í•¨ìˆ˜
 // ì‹œë®¬ë ˆì´ì…˜ í•µì‹¬ í•¨ìˆ˜
async function startSimulation() {
  const iterations = 1000;
  const batchSize = 25;
  let completed = 0;

  // í†µê³„ í•©ì‚°ìš© ë³€ìˆ˜ (ìµœì € ê¸°ë¡ ê´€ë ¨ ë³€ìˆ˜ ì œê±°)
  let totalTitanHp = 0, totalTime = 0, totalDead = 0, totalDmg = 0;

  const limitSec = Number(document.getElementById('timeLimitSelect').value) * 60;
  let timeSeriesHp = new Array(limitSec + 1).fill(0);
  let timeSeriesCount = new Array(limitSec + 1).fill(0);

  const btn = document.querySelector('.btn-simulate');
  const originalBtnText = "ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ âš”ï¸";
  btn.disabled = true;

  const bAtk = Number(document.getElementById('baseAtk').value);
  const bHp = Number(document.getElementById('baseHp').value);
  const tLv = document.getElementById('titanLevelSelect').value;
  const targetTitan = titanStats[tLv];
  const maxDino = Number(document.getElementById('dinoCount').value);
  const runes = selectedRunes.map(r => r ? { ...r, s: RUNES_DATA[r.name].levels[r.lv] } : null);

  let atkF_vamp = 0, atkP_vamp = 0;
  runes.forEach(r => {
    if (!r || (typeof vampExclusion !== 'undefined' && vampExclusion.includes(r.name))) return;
    if (r.s.atk_f) atkF_vamp += r.s.atk_f;
    if (r.s.atk_p) atkP_vamp += r.s.atk_p;
  });
  const vampBaseAtk = (bAtk + atkF_vamp) * (1 + atkP_vamp / 100);

  const runBatch = () => {
    const end = Math.min(completed + batchSize, iterations);

    for (let i = completed; i < end; i++) {
      let dinos = [];
      for (let dIdx = 0; dIdx < maxDino; dIdx++) {
        dinos.push({
          hp: 0, giftAtk: 0, giftSteps: 0, shieldSteps: 0, attackCount: 0
        });
      }

      let tHp = targetTitan.hp;
      let sessionTime = 0;
      let prevAliveCount = maxDino;
      let initialFullHp = 0;

      for (let t = 1; t <= limitSec; t++) {
        sessionTime = t;
        let aliveDinos = dinos.filter(d => d.hp > 0);
        let aliveCount = (t === 1) ? maxDino : aliveDinos.length;

        if (aliveCount <= 0) break;

        if (t > 1 && aliveCount < prevAliveCount) {
          if (prevAliveCount >= 5 && aliveCount < 5) {
            const coopRune = runes.find(r => r && r.name === "í˜‘ë™ ê³µê²©");
            if (coopRune && coopRune.s.hp_f) {
              dinos.forEach(d => { if (d.hp > 0) d.hp = Math.max(0, d.hp - coopRune.s.hp_f); });
            }
          }
          if (prevAliveCount === 1 && aliveCount > 1) {
            const soloRune = runes.find(r => r && r.name === "ê³ ë…í•œ ë¶„ë…¸");
            if (soloRune && soloRune.s.hp_f) {
              dinos.forEach(d => { if (d.hp > 0) d.hp = Math.max(0, d.hp - soloRune.s.hp_f); });
            }
          }
          aliveDinos = dinos.filter(d => d.hp > 0);
          aliveCount = aliveDinos.length;
          if (aliveCount <= 0) break;
        }
        prevAliveCount = aliveCount;

        let atkF = 0, atkP = 0, hpF = 0, hpP = 0;
        let cRate = 3, cDmg = 105;
        runes.forEach(r => {
          if (!r) return;
          let active = (r.name === "í˜‘ë™ ê³µê²©" ? aliveCount >= 5 : (r.name === "ê³ ë…í•œ ë¶„ë…¸" ? aliveCount === 1 : true));
          if (active) {
            if (r.s.atk_f) atkF += r.s.atk_f; if (r.s.atk_p) atkP += r.s.atk_p;
            if (r.s.hp_f) hpF += r.s.hp_f; if (r.s.hp_p) hpP += r.s.hp_p;
          }
          if (r.name === "ì¹˜ëª…íƒ€ í™•ë¥ ") cRate += r.s.value;
          if (r.name === "ì¹˜ëª…íƒ€ í”¼í•´") cDmg += r.s.value;
        });

        const currentMaxHp = (bHp + hpF) * (1 + hpP / 100);
        const currentAtk = (bAtk + atkF) * (1 + atkP / 100);

        if (t === 1) {
          initialFullHp = currentMaxHp;
          const sRune = runes.find(r => r && r.name === "ë³´í˜¸ë§‰");
          dinos.forEach(d => {
            d.hp = initialFullHp;
            d.shieldSteps = sRune ? sRune.s.turn : 0;
          });
          aliveDinos = dinos;
        }

        // --- ê³µë£¡ ê³µê²© ì‹œì‘ ---
        for (let d of aliveDinos) {
          d.attackCount++;
          let finalBaseAtk = currentAtk + d.giftAtk;
          const calcDmg = (val) => (Math.random() * 100 < cRate) ? val * (cDmg / 100) : val;

          tHp -= calcDmg(finalBaseAtk);

          const thunder = runes.find(r => r && r.name === "ë‚™ë¢°");
          if (thunder && Math.random() * 100 < thunder.s.prob) tHp -= calcDmg(finalBaseAtk * (thunder.s.value / 100));

          const meteor = runes.find(r => r && r.name === "ë©”í…Œì˜¤");
          if (meteor && Math.random() * 100 < meteor.s.prob) tHp -= calcDmg(finalBaseAtk * (meteor.s.value / 100));

          const triple = runes.find(r => r && r.name === "íŠ¸ë¦¬í”Œ ì„íŒ©íŠ¸");
          if (triple && d.attackCount % 3 === 0) tHp -= calcDmg(finalBaseAtk * (triple.s.value / 100));

          // íƒ€ì´íƒ„ ì‚¬ë§ ì²´í¬ (ì‚¬ë§ ì‹œ ì¦‰ì‹œ íƒˆì¶œ)
          if (tHp <= 0) {
            tHp = 0;
            break;
          }

          const vRune = runes.find(r => r && r.name === "í¡í˜ˆ");
          if (vRune && Math.random() * 100 < vRune.s.prob) {
            d.hp = Math.min(currentMaxHp, d.hp + (vampBaseAtk * vRune.s.value / 100));
          }

          if (d.giftSteps > 0) {
            d.giftSteps--;
            if (d.giftSteps === 0) d.giftAtk = 0;
          }
        }

        if (tHp <= 0) {
          tHp = 0;
          break; 
        }
        // --- ê³µë£¡ ê³µê²© ë ---

        if (t % 3 === 0) {
          let baseTDmg = targetTitan.atk;
          const healRune = runes.find(r => r && r.name === "í");
          const sRune = runes.find(r => r && r.name === "ë³´í˜¸ë§‰");
          const sacrificeRune = runes.find(r => r && r.name === "í¬ìƒ");
          const giftRune = runes.find(r => r && r.name === "ë§ˆì§€ë§‰ ì„ ë¬¼");
          const deathRune = runes.find(r => r && r.name === "ì£½ì„ ì¤€ë¹„");

          for (let d of dinos) {
            if (d.hp > 0) {
              if (healRune && Math.random() * 100 < healRune.s.prob) d.hp = Math.min(currentMaxHp, d.hp + (currentMaxHp * healRune.s.value / 100));
              
              let currentTDmg = baseTDmg;
              const skin1 = runes.find(r => r && r.name === "ë‹¨ë‹¨í•œ í”¼ë¶€ 1");
              const skin2 = runes.find(r => r && r.name === "ë‹¨ë‹¨í•œ í”¼ë¶€ 2");
              const res1 = runes.find(r => r && r.name === "í”¼í•´ ì €í•­ 1");
              const res2 = runes.find(r => r && r.name === "í”¼í•´ ì €í•­ 2");
              
              if (skin1) currentTDmg -= skin1.s.value;
              if (skin2) currentTDmg -= skin2.s.value;
              if (res1 && Math.random() * 100 < res1.s.prob) currentTDmg -= res1.s.value;
              if (res2 && Math.random() * 100 < res2.s.prob) currentTDmg -= res2.s.value;
              
              currentTDmg = Math.max(0, currentTDmg);
              if (d.shieldSteps > 0) {
                currentTDmg = currentTDmg * (1 - (sRune ? sRune.s.value : 0) / 100);
                d.shieldSteps--;
              }
              d.hp = Math.max(0, d.hp - currentTDmg);

              if (d.hp === 0) {
                if (sacrificeRune && Math.random() * 100 < sacrificeRune.s.prob) {
                  dinos.forEach(target => { if (target.hp > 0) target.hp = Math.min(currentMaxHp, target.hp + (currentMaxHp * sacrificeRune.s.value / 100)); });
                }
                if (deathRune && Math.random() * 100 < deathRune.s.prob) {
                  tHp -= (currentAtk * deathRune.s.value / 100);
                  if (tHp <= 0) tHp = 0; // ì£½ì¤€ ë°ë¯¸ì§€ë¡œ íƒ€ì´íƒ„ ì‚¬ë§ ì‹œ
                }
                if (giftRune && Math.random() * 100 < giftRune.s.prob) {
                  dinos.forEach(target => { if (target.hp > 0) { target.giftAtk += (currentAtk * giftRune.s.value / 100); target.giftSteps = giftRune.s.turn; } });
                }
              }
            }
          }
          if (tHp <= 0) { tHp = 0; break; }
        }

        let tickHpSum = 0;
        let safeFullHp = initialFullHp > 0 ? initialFullHp : 1;
        dinos.forEach(d => tickHpSum += (Math.max(0, d.hp) / safeFullHp) * 100);
        timeSeriesHp[t] += (tickHpSum / maxDino);
        timeSeriesCount[t]++;

        if (tHp <= 0) { tHp = 0; break; }
      }

      totalTitanHp += Math.max(0, tHp);
      totalTime += sessionTime;
      totalDead += dinos.filter(d => d.hp <= 0).length;
      totalDmg += (targetTitan.hp - Math.max(0, tHp));
    }

    completed = end;
    btn.innerText = `ì‹œë®¬ë ˆì´ì…˜ ì¤‘(${completed}/1000)...`;

    if (completed < iterations) {
      setTimeout(runBatch, 0);
    } else {
      finalize();
    }
  };

  const finalize = () => {
    const rep = document.getElementById('battleReport');
    rep.style.display = 'block';

    let validTicks = 0, totalAvgSum = 0;
    for (let k = 1; k <= limitSec; k++) {
      if (timeSeriesCount[k] > 0) {
        totalAvgSum += (timeSeriesHp[k] / timeSeriesCount[k]);
        validTicks++;
      }
    }
    const finalRollingAvg = totalAvgSum / (validTicks || 1);

    document.getElementById('repTotalDmg').innerText = Math.floor(totalDmg / iterations).toLocaleString();
    document.getElementById('repTitanHp').innerText = Math.max(0, Math.floor(totalTitanHp / iterations)).toLocaleString();
    
    const avgSec = totalTime / iterations;
    document.getElementById('repTime').innerText = `${Math.floor(avgSec / 60)}ë¶„ ${Math.floor(avgSec % 60)}ì´ˆ`;
    document.getElementById('repDead').innerText = `${(totalDead / iterations).toFixed(1)}ë§ˆë¦¬`;
    
    document.getElementById('avgMinHpPer').innerText = finalRollingAvg.toFixed(1) + '%';
    document.getElementById('hpBarFill').style.width = Math.max(0, finalRollingAvg) + '%';

    // ìµœì € ê¸°ë¡ UI ì´ˆê¸°í™” (ë¡œì§ ì œê±°ë¨)
    const absMinEl = document.getElementById('absoluteMinHp');
    if (absMinEl) absMinEl.innerText = "-";

    btn.disabled = false;
    btn.innerText = originalBtnText;
    rep.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  };

  runBatch();
}

    function getImgUrl(id) {
      return id ? `https://lh3.googleusercontent.com/d/${id}` : "";
    }
  </script>
</body>

</html>
