<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="naver-site-verification" content="bd53a0080e133411c6579b118c107c8cd673145a" />
  <meta name="google-site-verification" content="L98MFUbflpT6ium7ciRsL5ztwsoQ40egIudAwjXgR7c" />
  <title>ë‹¤ì´ë…¸ ë®¤í„´íŠ¸ íƒ€ì´íƒ„ ì‹œë®¬ë ˆì´í„°</title>
  <meta name="description" content="ë‹¤ì´ë…¸ ë®¤í„´íŠ¸ì˜ íƒ€ì´íƒ„ ë³´ìŠ¤ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ì˜ˆì¸¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì ì˜ ë£¬ ì„¸íŒ…ì„ ì°¾ì•„ë³´ì„¸ìš”.">
  <meta name="keywords" content="ë‹¤ì´ë…¸ ë®¤í„´íŠ¸, íƒ€ì´íƒ„, ì‹œë®¬ë ˆì´í„°, ë£¬, ë£¬ ì„¸íŒ…, ìŠ¤íƒ¯, ê³„ì‚°">
  <style>
    :root {
      /* ê³µí†µ ë“±ê¸‰ ìƒ‰ìƒ */
      --ì¼ë°˜: #9e9e9e;
      --í¬ê·€: #4caf50;
      --ì—í”½: #ff9800;
      --ìœ ë‹ˆí¬: #eb5f0e;
      --ì „ì„¤: #ba0000;
      --primary: #2196F3;
      /* ë‹¤í¬ ëª¨ë“œ (ê¸°ë³¸) */
      --bg-color: #1a252f;
      --card-bg: #2c3e50;
      --input-bg: #3e4f5f;
      --text-main: #ffffff;
      --text-sub: #bdc3c7;
      --border-color: rgba(255, 255, 255, 0.1);
      --slot-border: #4f6272;
    }

    /* ë¼ì´íŠ¸ ëª¨ë“œ í´ë˜ìŠ¤ */
    body.light-mode {
      --bg-color: #f0f2f5;
      --card-bg: #ffffff;
      --input-bg: #f8f9fa;
      --text-main: #2c3e50;
      --text-sub: #7f8c8d;
      --border-color: rgba(0, 0, 0, 0.1);
      --slot-border: #dcdde1;
    }

    /* ì‚¬ì´íŠ¸ ì „ì²´(HTML, BODY) ìŠ¤í¬ë¡¤ ë°” ìˆ¨ê¸°ê¸° */
    html,
    body {
      -ms-overflow-style: none;
      /* IE, Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    html::-webkit-scrollbar,
    body::-webkit-scrollbar {
      display: none;
      /* Chrome, Safari, Opera */
    }

    body {
      font-family: 'Pretendard', sans-serif;
      background: var(--bg-color);
      color: var(--text-main);
      padding: 20px 0;
      /* ì¢Œìš° íŒ¨ë”©ì€ ë¹¼ê³  ìœ„ì•„ë˜ë§Œ ì¤ë‹ˆë‹¤ */
      display: flex;
      flex-direction: column;
      /* ì„¸ë¡œ ë°©í–¥ìœ¼ë¡œ ìŒ“ì´ê²Œ */
      align-items: center;
      /* ê°€ë¡œì¶• ì¤‘ì•™ ì •ë ¬ */
      margin: 0;
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
      overflow-x: hidden;
      /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    }

    .container {
      width: 95%;
      /* ëª¨ë°”ì¼ ê¸°ë³¸ ì—¬ë°± */
      max-width: 600px;
      /* PC ìµœëŒ€ ë„ˆë¹„ */
      display: flex;
      flex-direction: column;
      gap: 20px;
      box-sizing: border-box;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      width: 100%;
      /* ì»¨í…Œì´ë„ˆì— ê½‰ ì°¨ê²Œ */
      box-sizing: border-box;
      margin: 0 auto;
      /* ì¹´ë“œ ìì²´ ì¤‘ì•™ ì •ë ¬ */
    }

    .button-group,
    .grid-2col {
      display: flex;
      flex-wrap: nowrap;
      /* ê°€ë¡œ ë°°ì—´ ìœ ì§€ */
      gap: 8px;
      width: 100%;
    }

    .button-group button,
    .grid-2col>div {
      flex: 1;
      /* ëª¨ë“  ìš”ì†Œê°€ ë™ì¼í•œ ë¹„ìœ¨ë¡œ ë„ˆë¹„ë¥¼ ë‚˜ëˆ  ê°€ì§ */
      min-width: 0;
      /* flex ì•„ì´í…œì´ ì¹¸ì„ ëš«ê³  ë‚˜ê°€ëŠ” í˜„ìƒ ë°©ì§€ */
    }

    @media (max-width: 380px) {
      body {
        font-size: 13px;
        /* ì „ì²´ì ì¸ ê¸°ë³¸ í°íŠ¸ ì¶•ì†Œ */
      }

      h2 {
        font-size: 1.1rem;
        /* ì œëª© í¬ê¸° ì¶•ì†Œ */
      }

      .stat-row {
        font-size: 12px;
        /* ì „íˆ¬ ë°ì´í„° ì¤„ ê°„ê²©ê³¼ í°íŠ¸ ìµœì í™” */
      }
    }

    h2 {
      margin: 0 0 16px 0;
      font-size: 1rem;
      color: var(--text-main);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 18px;
    }

    .input-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 6px;
      font-weight: 600;
    }

    input,
    select {
      width: 100%;
      padding: 12px;
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      color: var(--text-main);
      box-sizing: border-box;
      outline: none;
      transition: background 0.3s, border 0.3s;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .slot-wrapper {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      /* 5ê°œ ìœ ì§€ */
      gap: 8px;
      /* ê°„ê²©ì„ ì‚´ì§ ì¢í˜ */
      margin-top: 10px;
      width: 100%;
      box-sizing: border-box;
    }

    .slot {
      aspect-ratio: 1;
      border: 2px dashed var(--slot-border);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      background: var(--input-bg);
      overflow: hidden;
      transition: 0.2s;
    }

    .slot.active {
      border-color: #f1c40f;
      background: rgba(33, 150, 243, 0.1);
    }

    .slot-img {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .slot-lv-tag {
      position: absolute;
      bottom: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      font-size: 10px;
      text-align: center;
      padding: 2px 0;
    }

    /* ë£¬ ëª©ë¡ ìŠ¤í¬ë¡¤ ì˜ì—­ */
    .rune-scroll-container {
      max-height: 300px;
      /* ëª©ë¡ì˜ ìµœëŒ€ ë†’ì´ (ì´í›„ ìŠ¤í¬ë¡¤ ë°œìƒ) */
      overflow-y: auto;
      /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
      padding-right: 5px;
      /* ìŠ¤í¬ë¡¤ë°” ë””ìì¸ (ì„ íƒ ì‚¬í•­) */
      scrollbar-width: thin;
      scrollbar-color: var(--primary) transparent;
    }

    /* í¬ë¡¬, ì‚¬íŒŒë¦¬ìš© ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° í˜¹ì€ ë””ìì¸ */
    .rune-scroll-container::-webkit-scrollbar {
      width: 4px;
    }

    .rune-scroll-container::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    #runePicker {
      display: none;
      margin-top: 15px;
      background: var(--input-bg);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      padding: 15px;
      box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
      /* ì•ˆìœ¼ë¡œ íŒŒì¸ ëŠë‚Œ */
    }

    .rune-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: clamp(8px, 2vw, 15px);
      width: 100%;
      padding: 0 !important;
      margin: 0 auto !important;
      justify-items: center;
      box-sizing: border-box;
      align-items: start;
    }

    .rune-item {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 5px 0;
      box-sizing: border-box;
    }

    /* í•µì‹¬: ê³ ì • px ì œê±° ë° ë¹„ìœ¨í˜• ì»¨í…Œì´ë„ˆ */
    .rune-img-container {
      /* ë¶€ëª¨ ë„ˆë¹„ì˜ 90%ë¥¼ ì°¨ì§€í•˜ê²Œ í•˜ì—¬ 4ì—´ ë‚´ì—ì„œ ìë™ í¬ê¸° ì¡°ì ˆ */
      width: 90%;
      /* ë„ˆë¹„ì— ë§ì¶° ë†’ì´ë¥¼ í•­ìƒ ì •ì‚¬ê°í˜•ìœ¼ë¡œ ìœ ì§€ */
      aspect-ratio: 1 / 1;
      margin: 0 auto 8px;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid var(--slot-border);
      background: var(--bg-color);
      display: flex;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
      /* ë„ˆë¬´ ì»¤ì§€ëŠ” ê²ƒ ë°©ì§€ (PC ê¸°ì¤€) */
      max-width: 75px;
    }

    .rune-img-container img {
      width: 100%;
      height: 100%;
      /* ì´ë¯¸ì§€ê°€ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šê²Œ ì±„ì›€ */
      object-fit: cover;
      display: block;
    }

    .rune-label {
      /* ê¸€ì í¬ê¸°ë„ í™”ë©´ì´ ì‘ì•„ì§€ë©´ ë¯¸ì„¸í•˜ê²Œ ì¡°ì • */
      font-size: clamp(9px, 2.5vw, 11px);
      font-weight: bold;
      color: var(--text-main);
      text-align: center;
      width: 100%;
      word-break: keep-all;
      line-height: 1.2;
    }

    /* ê¸°ì¡´ ë¡œì§ ìœ ì§€ */
    #unsuitableGrid .rune-img-container {
      filter: grayscale(0.5) opacity(0.8);
    }

    #runeDetail {
      display: none;
      margin-top: 15px;
      padding: 15px;
      background: var(--card-bg);
      border-radius: 10px;
      border: 1px solid var(--border-color);
    }

    /* ëª¨ë°”ì¼ ì „ìš© ë¯¸ì„¸ ì¡°ì • (ë¯¸ë””ì–´ ì¿¼ë¦¬ ìµœì†Œí™”) */
    @media (max-width: 480px) {
      .rune-img-container {
        /* ëª¨ë°”ì¼ì—ì„œëŠ” í…Œë‘ë¦¬ ë‘ê»˜ë¥¼ ì‚´ì§ ì¤„ì—¬ ê³µê°„ í™•ë³´ */
        border-width: 1.5px;
        border-radius: 8px;
      }
    }

    .desc-box {
      font-size: 13px;
      color: var(--text-main);
      margin: 10px 0;
      padding: 10px;
      background: var(--card-bg);
      white-space: pre-line;
    }

    .btn-apply {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-simulate {
      width: 100%;
      padding: 16px;
      background: #e67e22;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 900;
      cursor: pointer;
      margin-top: 20px;
      font-size: 1.1rem;
    }

    .report-box {
      margin-top: 20px;
      padding: 15px;
      background: var(--bg-color);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      display: none;
      line-height: 1.6;
    }

    .report-item {
      color: var(--text-main);
      font-size: 14px;
      margin-bottom: 5px;
    }

    .report-val {
      color: #f1c40f;
      font-weight: bold;
      float: right;
    }

    .app-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: var(--card-bg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 1000;
      border-bottom: 1px solid var(--border-color);
      transition: background 0.3s;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-btn {
      background: none;
      border: none;
      color: var(--text-main);
      cursor: pointer;
    }

    .app-title .brand {
      font-size: 16px;
      font-weight: 800;
      color: var(--primary);
    }

    .app-title .sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    /* 1. ê·¸ë£¹ ì„¤ì •: 2ì—´ ìœ ì§€í•˜ë˜ ë‚´ìš©ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ */
    .stat-group {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px 8px;
      margin-bottom: 15px;
    }

    /* 2. ê° í–‰: ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ìˆ˜ì¹˜ê°€ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ë„ë¡ ì„¤ì • */
    .stat-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px 4px;
      /* ì¤„ë°”ê¿ˆ ì‹œ í–‰ê°„(8px)ì„ ì£¼ì–´ ê²¹ì¹¨ ì›ì²œ ì°¨ë‹¨ */
      margin-bottom: 10px;
    }

    /* 3. ë¼ë²¨: ì´ë¦„ì´ ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šê²Œ ë³´í˜¸ */
    .stat-row span:first-child {
      flex-shrink: 0;
      white-space: nowrap;
    }

    .stat-val {
      display: inline-block;
      position: relative;
      font-weight: bold;
      color: #f1c40f !important;
      cursor: pointer;
      padding-right: 18px;
      word-break: break-all;
    }

    /* 5. ì•„ì´ì½˜: ìˆ˜ì¹˜ ë°”ë¡œ ì˜¤ë¥¸ìª½ì— ê³ ì • */
    #resRed::after,
    #resVamp::after {
      content: 'â‡„';
      position: absolute;
      top: 1px;
      right: 0;
      font-size: 12px;
      color: #00ffcc;
      opacity: 0.9;
      font-weight: bold;
      pointer-events: none;
      line-height: 1;
    }

    /* 6. ì•„ì£¼ ì‘ì€ ëª¨ë°”ì¼ í™”ë©´ì—ì„œë§Œ ë¯¸ì„¸ ì¡°ì • */
    @media (max-width: 360px) {
      .stat-group {
        gap: 8px 4px;
      }

      .stat-row {
        font-size: 0.9rem;
      }
    }

    /* ì‚¬ì´ë“œë°” ì• ë‹ˆë©”ì´ì…˜ ë° ìŠ¤íƒ€ì¼ */
    .side-menu {
      position: fixed;
      top: 0;
      left: -280px;
      width: 280px;
      height: 100%;
      background: var(--card-bg);
      z-index: 2000;
      transition: 0.3s ease;
      padding: 20px;
      box-sizing: border-box;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
    }

    .side-menu.open {
      left: 0;
    }

    .side-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 15px;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1999;
    }

    .theme-toggle-btn {
      padding: 6px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text-main);
      cursor: pointer;
      font-size: 13px;
    }

    /* í† ê¸€ ìŠ¤ìœ„ì¹˜ ë””ìì¸ */
    .switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 22px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 22px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    /* ON ìƒíƒœì¼ ë•Œì˜ ë°°ê²½ìƒ‰ì„ ë…¸ë€ìƒ‰(#f1c40f)ìœ¼ë¡œ ë³€ê²½ */
    input:checked+.slider {
      background-color: #f1c40f;
    }

    /* ON ìƒíƒœì¼ ë•Œ ë™ê·¸ë¼ë¯¸(before)ê°€ ì´ë™í•˜ëŠ” ë¡œì§ */
    input:checked+.slider:before {
      transform: translateX(22px);
    }

    .hp-bar-container {
      background: #444;
      border-radius: 10px;
      height: 20px;
      width: 100%;
      margin: 10px 0;
      position: relative;
      overflow: hidden;
    }

    .hp-bar-fill {
      background: linear-gradient(90deg, #e74c3c, #2ecc71);
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
    }

    .min-record-text {
      font-size: 11px;
      color: var(--text-sub);
      text-align: right;
      display: block;
      margin-top: -5px;
    }

    .close-btn {
      background: none;
      border: none;
      color: var(--text-main);
      font-size: 20px;
      cursor: pointer;
    }

    .custom-dropdown {
      position: relative;
      width: 100%;
    }

    .selected-value {
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      color: var(--text-main);
      position: relative;
    }

    .selected-value::after {
      content: "â–¼";
      position: absolute;
      right: 15px;
      font-size: 10px;
      color: #f1c40f;
    }

    .dropdown-list {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 250px;
      overflow-y: auto;
      background: var(--card-bg);
      border: 1px solid #f1c40f;
      border-radius: 0 0 8px 8px;
      z-index: 10000;
      padding: 0;
      margin: 0;
      list-style: none;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
      -ms-overflow-style: none;
      /* IE, Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    b .dropdown-list::-webkit-scrollbar {
      display: none;
    }

    .dropdown-list li {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid var(--border-color);
      font-size: 14px;
    }

    .dropdown-list li:hover {
      background: var(--input-bg);
      color: #f1c40f;
    }

    /*í”¼í•´ ê°ì†ŒëŸ‰, í¡í˜ˆëŸ‰ í‘œì‹œ ì „í™˜*/
    #resRed,
    #resVamp {
      position: relative;
      display: inline-block;
      padding-right: 18px;
    }

    #resRed::after,
    #resVamp::after {
      content: 'â‡„';
      position: absolute;
      top: -2px;
      right: 0;
      font-size: 12px;
      color: #2196F3;
      font-weight: bold;
      opacity: 0.7;
    }

    /* ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¸ì„ ë•Œ ë” ë°ê²Œ í‘œì‹œ */
    #resRed:hover::after,
    #resVamp:hover::after {
      opacity: 1;
      text-shadow: 0 0 5px #00ffcc;
    }
  </style>
</head>

<body>

  <div id="sideMenu" class="side-menu">
    <div class="side-header">
      <span style="font-weight: bold;">ì„¤ì •</span>
      <button class="close-btn" onclick="toggleMenu()">âœ•</button>
    </div>
    <div class="menu-content" style="padding: 20px 15px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <span style="font-size: 14px;">í…Œë§ˆ ì „í™˜</span>
        <button onclick="toggleTheme()" id="themeBtn" class="theme-toggle-btn">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
      </div>

      <div style="display: flex; justify-content: space-between; align-items: center;">
        <span style="font-size: 14px;">ìƒì„¸ ë¡œê·¸ ìˆ˜ì§‘</span>
        <label class="switch">
          <input type="checkbox" id="logToggle">
          <span class="slider round"></span>
        </label>
      </div>
    </div>
  </div>
  <div id="menuOverlay" class="menu-overlay" onclick="toggleMenu()"></div>

  <header class="app-bar">
    <div class="header-left">
      <button class="menu-btn" onclick="toggleMenu()"> <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
          <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
        </svg>
      </button>
      <div class="app-title">
        <span class="brand">DINO MUTANT</span>
        <span class="sub">íƒ€ì´íƒ„ ì‹œë®¬ë ˆì´í„°</span>
      </div>
    </div>
  </header>

  <div class="container" style="margin-top: 60px;">
    <div class="warning" style="text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 15px; margin-bottom: 5px;">
      â€» ë³¸ ì‹œë®¬ë ˆì´í„°ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ì—°ì‚° ë°©ì‹ê³¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </div>
    <div class="card">
      <h2>ë‚´ ê³µë£¡ ì •ë³´</h2>
      <div class="input-grid">
        <div>
          <label>ê¸°ë³¸ ê³µê²©ë ¥</label>
          <input type="tel" id="baseAtk" value="1" oninput="this.value = this.value.replace(/[^0-9]/g, ''); calcFinal();" onblur="if(this.value === '' || Number(this.value) < 1) this.value = 1; calcFinal();" onfocus="this.select()" placeholder="ìµœì†Œì¹˜ 1">
        </div>

        <div>
          <label>ê¸°ë³¸ ì²´ë ¥</label>
          <input type="tel" id="baseHp" value="10" oninput="this.value = this.value.replace(/[^0-9]/g, ''); calcFinal();" onblur="if(this.value === '' || Number(this.value) < 10) this.value = 10; calcFinal();" onfocus="this.select()" placeholder="ìµœì†Œì¹˜ 10">
        </div>
        <div class="full-width">
          <label>ê³µë£¡ ìˆ˜</label>
          <select id="dinoCount" onchange="calcFinal()"></select>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ì¥ì°©ëœ ë£¬</h2>
      <div class="slot-wrapper" id="slotContainer"></div>
      <div id="runePicker">
        <div class="rune-scroll-container">
          <div class="rune-grid" id="mainGrid"></div>
          <div class="divider" style="text-align: center; color: #e74c3c; font-size: 11px; padding: 15px 0;">
            â”€â”€ íƒ€ì´íƒ„ì— ì í•©í•˜ì§€ ì•Šì€ ë£¬ì…ë‹ˆë‹¤ â”€â”€
          </div>
          <div class="rune-grid" id="unsuitableGrid"></div>
        </div>
        <div id="runeDetail" style="border-top: 1px solid var(--border-color); margin-top: 15px; padding-top: 15px;">
          <div id="detailGrade" style="font-size:11px; font-weight:bold;"></div>
          <h3 id="detailName" style="margin:5px 0; font-size: 1.1rem;"></h3>
          <div id="levelArea">
            <select id="levelSelect"></select>
            <div class="desc-box" id="detailDesc"></div>
          </div>
          <button class="btn-apply" id="applyBtn" onclick="applyRuneToSlot()">ìŠ¬ë¡¯ì— ì¥ì°©</button>
          <button class="btn-apply" id="removeBtn" onclick="removeRuneFromSlot()" style="background:#7f8c8d; margin-top:5px;">ì¥ì°© í•´ì œ</button>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ì „íˆ¬ ì„¤ì •</h2>
      <div class="input-grid">
        <div class="full-width">
          <label>íƒ€ì´íƒ„ ë ˆë²¨ ì„ íƒ</label>
          <div class="custom-dropdown" id="titanDropdown">
            <div class="selected-value" onclick="toggleDropdown('titanList')">Lv.1 (ATK 5 / HP 2,500,000)</div>
            <ul class="dropdown-list" id="titanList"></ul>
            <input type="hidden" id="titanLevelSelect" value="1">
          </div>
        </div>

        <div class="full-width">
          <label>ì „íˆ¬ ì œí•œ ì‹œê°„</label>
          <div class="custom-dropdown" id="timeDropdown">
            <div class="selected-value" onclick="toggleDropdown('timeList')">90ë¶„</div>
            <ul class="dropdown-list" id="timeList"></ul>
            <input type="hidden" id="timeLimitSelect" value="90">
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ì‹¤ì‹œê°„ ì „íˆ¬ ì‹œë®¬ë ˆì´ì…˜</h2>
      <div class="stat-group">
        <div class="stat-row">ìµœì¢… ê³µê²©ë ¥: <span class="stat-val" id="resAtk">0</span></div>
        <div class="stat-row">ìµœì¢… ì²´ë ¥: <span class="stat-val" id="resHp">0</span></div>
        <div class="stat-row">í”¼í•´ ê°ì†ŒëŸ‰: <span class="stat-val" id="resRed" onclick="toggleDefenseMode()" style="cursor:pointer; color:#00ffcc;">0</span></div>
        <div class="stat-row">í¡í˜ˆ íšŒë³µëŸ‰: <span class="stat-val" id="resVamp" onclick="toggleVampMode()" style="cursor:pointer; color:#00ffcc;">0</span></div>
      </div>
    </div>

    <button class="btn-simulate" onclick="startSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ âš”ï¸</button>

    <div id="battleReport" class="report-box">
      <div class="report-item">ì´ ì…íŒ í”¼í•´ëŸ‰ <span class="report-val" id="repTotalDmg">0</span></div>
      <div class="report-item">ë‚¨ì€ íƒ€ì´íƒ„ ì²´ë ¥ <span class="report-val" id="repTitanHp">0</span></div>
      <div class="report-item">í‰ê·  ì „íˆ¬ ì‹œê°„ <span class="report-val" id="repTime">0</span></div>
      <div class="report-item">í‰ê·  ê³µë£¡ ì‚¬ë§ ìˆ˜ <span class="report-val" id="repDead">0</span></div>

      <div style="margin-top:20px; border-top:1px solid var(--border-color); padding-top:15px;">
        <div class="report-item" style="margin-bottom:10px;">ì‹œê°„ëŒ€ë³„ ê³µë£¡ ì²´ë ¥ ë³€í™” ì¶”ì´</div>

        <div style="background: rgba(0,0,0,0.2); border-radius: 8px; padding: 10px; height: 180px; position: relative;">
          <canvas id="hpChart"></canvas>
        </div>

        <div id="avgMinHpPer" style="text-align: center; margin-top: 10px; color: var(--í¬ê·€); font-weight: bold; font-size: 1.1em;">
          í‰ê·  ìƒì¡´ ì²´ë ¥: 0%
        </div>
      </div>
    </div>
  </div>

  <script>
    // ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ë¶€
    let isLogEnabled = false;
    let detailedLogs = [];
    // ìƒì„¸ ë¡œê·¸ í† ê¸€ ì´ë²¤íŠ¸ (ìŠ¤í¬ë¦½íŠ¸ í•˜ë‹¨ì— ì¶”ê°€)
    document.getElementById('logToggle').addEventListener('change', (e) => {
      isLogEnabled = e.target.checked;
      // ë¡œê·¸ë¥¼ ì¼œë©´ ê¸°ì¡´ ë¡œê·¸ ì´ˆê¸°í™”
      if (isLogEnabled) {
        detailedLogs = [];
        console.log("ìƒì„¸ ë¡œê·¸ ìˆ˜ì§‘ í™œì„±í™”");
      }
    });

    function toggleDropdown(id) {
      const list = document.getElementById(id);
      const isOpen = list.style.display === 'block';
      document.querySelectorAll('.dropdown-list').forEach(el => el.style.display = 'none');
      list.style.display = isOpen ? 'none' : 'block';
    }
    // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
    window.addEventListener('click', (e) => {
      if (!e.target.closest('.custom-dropdown')) {
        document.querySelectorAll('.dropdown-list').forEach(el => el.style.display = 'none');
      }
    });

    function toggleMenu() {
      const menu = document.getElementById('sideMenu');
      const overlay = document.getElementById('menuOverlay');
      const isOpen = menu.classList.toggle('open');
      overlay.style.display = isOpen ? 'block' : 'none';
    }

    function toggleTheme() {
      const isLight = document.body.classList.toggle('light-mode');
      const themeBtn = document.getElementById('themeBtn');
      themeBtn.innerText = isLight ? 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
      localStorage.setItem('dino_theme', isLight ? 'light' : 'dark');
    }
    window.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('dino_theme') === 'light') {
        document.body.classList.add('light-mode');
        const themeBtn = document.getElementById('themeBtn');
        if (themeBtn) themeBtn.innerText = 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
      }
    });
    // ë£¬ ë°ì´í„° ì˜ì—­ (ì´ê³³ì— ìˆ˜ì •í•˜ì‹  ë£¬ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”)
    const RUNES_DATA = {
      "í": {
        grade: "ì¼ë°˜",
        imgId: "10kOU5_hHneBmIpMJ-Hx0FuN-UanR5FDN",
        desc: "ìœ ë‹›ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ {prob}% í™•ë¥ ë¡œ ë‚´ ìœ ë‹› ìµœëŒ€ ì²´ë ¥ì˜ {rec_p}% íšŒë³µ",
        levels: (function() {
          let lv = {};
          const p = [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 13];
          const v = [1, 1.1, 1.2, 1.3, 1.4, 2, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3.5, 3.6, 3.7, 3.8, 3.9, 4, 4.1, 4.2, 4.3, 4.4, 5, 5.1, 5.2, 5.3, 5.4, 8];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            rec_p: v[i]
          });
          return lv;
        })()
      },
      "ê³µê²©ë ¥ ì¦ê°€ 1": {
        grade: "ì¼ë°˜",
        imgId: "1ihowBMqeNvWag_4ou2JLgYilpLGvgnPa",
        desc: "ìœ ë‹› ê³µê²©ë ¥ {atk_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: i
          };
          return lv;
        })()
      },
      "ì²´ë ¥ ì¦ê°€ 1": {
        grade: "ì¼ë°˜",
        imgId: "1vNpdtLIozfnNOhjl2-gIMFH33xLmgh3P",
        desc: "ìœ ë‹› ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            hp_f: i * 25
          };
          return lv;
        })()
      },
      "í¬ìƒ": {
        grade: "ì¼ë°˜",
        imgId: "1Yuy6PLeo7Jx-fAef04PVuqmiZjR_mw64",
        desc: "ì‚¬ë§ ì‹œ {prob}% í™•ë¥ ë¡œ ê°™ì€ íƒ€ì¼ì— ìˆëŠ” ë™ì¼ ë¶€ì¡± ì†Œì†ì˜ ìœ ë‹›ì—ê²Œ ë‚˜ì˜ ìœ ë‹› ìµœëŒ€ ì²´ë ¥ì˜ {rec_p}% íšŒë³µ",
        levels: (function() {
          let lv = {};
          const p = [35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 50];
          const v = [10, 10.5, 11, 11.5, 12, 15, 15.5, 16, 16.5, 17, 20, 20.5, 21, 21.5, 22, 25, 25.5, 26, 26.5, 27, 30, 30.5, 31, 31.5, 32, 35, 35.5, 36, 36.5, 37, 45];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            rec_p: v[i]
          });
          return lv;
        })()
      },
      "ë§ˆì§€ë§‰ ì„ ë¬¼": {
        grade: "ì¼ë°˜",
        imgId: "16X52VhA2_Z-UFH6bNFdqA_XkXwPdWZJg",
        desc: "ì‚¬ë§ ì‹œ {prob}% í™•ë¥ ë¡œ ê°™ì€ íƒ€ì¼ì— ìˆëŠ” ë™ì¼ ë¶€ì¡± ì†Œì†ì˜ ìœ ë‹›ì—ê²Œ ê³µê²©ë ¥ {atk_f} ì¦ê°€ ë²„í”„ {turn}í„´ ì§€ì†",
        levels: (function() {
          let lv = {};
          const p = [40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 60];
          const t = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4];
          for (let i = 1; i <= 31; i++) lv[i] = {
            prob: p[i - 1],
            atk_f: 14 + i,
            turn: t[i - 1]
          };
          return lv;
        })()
      },
      "íŠ¸ë¦¬í”Œ ì„íŒ©íŠ¸": {
        grade: "ì¼ë°˜",
        imgId: "1nO4CtfdB_FH7ZvCmL3uj1QPLDJte5mLB",
        desc: "ì„¸ë²ˆ ì§¸ ê³µê²©ë§ˆë‹¤ ë‚´ ìœ ë‹›ì˜ ê³µê²©ë ¥ì˜ {burst_p}%ì˜ ì¶”ê°€ í”¼í•´",
        levels: (function() {
          let lv = {};
          const v = [2, 2.5, 3, 3.5, 4, 6, 6.5, 7, 7.5, 8, 10, 10.5, 11, 11.5, 12, 14, 14.5, 15, 15.5, 16, 18, 18.5, 19, 19.5, 20, 22, 22.5, 23, 23.5, 24, 27];
          v.forEach((x, i) => lv[i + 1] = {
            burst_p: x
          });
          return lv;
        })()
      },
      "ë‹¨ë‹¨í•œ í”¼ë¶€ 1": {
        grade: "ì¼ë°˜",
        imgId: "1oHu7Ep7BwL7Es4dBRVdTyfnSrfd_xIq1",
        desc: "ì  ìœ ë‹›ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ í”¼í•´ {red_f}ë§Œí¼ ê°ì†Œ",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            red_f: i * 2
          };
          return lv;
        })()
      },
      "í”¼í•´ ì €í•­ 1": {
        grade: "ì¼ë°˜",
        imgId: "1tBCAdO-UyCTP32gHwEc7TVISeRINsrqa",
        desc: "ì  ìœ ë‹›ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ {prob}%ì˜ í™•ë¥ ë¡œ í”¼í•´ {red_f}ë§Œí¼ ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const p = [30, 30, 30, 30, 30, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 50];
          const v = [30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 62, 64, 66, 68, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            red_f: v[i]
          });
          return lv;
        })()
      },
      "ë³´í˜¸ë§‰": {
        grade: "ì¼ë°˜",
        imgId: "1-FCajygUymZcpCCxaK7_Scg5NtiPKyiM",
        desc: "{turn}ë²ˆì˜ ì  ê³µê²© í”¼í•´ë¥¼ {red_p}% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const t = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3];
          const v = [1, 1.5, 2, 2.5, 3, 5, 5.5, 6, 6.5, 7, 10, 10.5, 11, 11.5, 12, 13, 13.5, 14, 14.5, 15, 18, 18.5, 19, 19.5, 20, 22, 22.5, 23, 23.5, 24, 28];
          t.forEach((x, i) => lv[i + 1] = {
            turn: x,
            red_p: v[i]
          });
          return lv;
        })()
      },
      "ê³µê²©ë ¥ ì¦ê°€ 2": {
        grade: "í¬ê·€",
        imgId: "1PKky7_H1ZXJNxzZJhByTw7hUclQ0aTRG",
        desc: "ìœ ë‹› ê³µê²©ë ¥ {atk_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: 15 + i - 1
          };
          return lv;
        })()
      },
      "ì²´ë ¥ ì¦ê°€ 2": {
        grade: "í¬ê·€",
        imgId: "1oIkxrSL3mVZo-fHXOv2Ot2Zmmftwpp3H",
        desc: "ìœ ë‹› ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            hp_f: 375 + (i - 1) * 25
          };
          return lv;
        })()
      },
      "í˜‘ë™ ê³µê²©": {
        grade: "í¬ê·€",
        imgId: "1DzFWPRILgHZAF28JrzUzKZQWKCtAN2vR",
        desc: "ê°™ì€ íƒ€ì¼ì— ë‚´ ìœ ë‹›ì´ 5ë§ˆë¦¬ ì´ìƒì¼ ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_f} ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          const a = [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 62, 64, 66, 68, 75];
          const h = [875, 900, 925, 950, 975, 1000, 1025, 1050, 1075, 1100, 1125, 1150, 1175, 1200, 1225, 1250, 1275, 1300, 1325, 1350, 1375, 1400, 1425, 1450, 1475, 1500, 1550, 1600, 1650, 1700, 1875];
          a.forEach((x, i) => lv[i + 1] = {
            atk_f: x,
            hp_f: h[i]
          });
          return lv;
        })()
      },
      "ê³ ë…í•œ ë¶„ë…¸": {
        grade: "í¬ê·€",
        imgId: "1hAyyAwatFwvlKqth4sunU_gURWoTY4ZJ",
        desc: "ê°™ì€ íƒ€ì¼ì— ë‚´ ìœ ë‹›ì´ 1ë§ˆë¦¬ì¼ ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_f} ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: 15 + i - 1,
            hp_f: 375 + (i - 1) * 25
          };
          return lv;
        })()
      },
      "ë‹¨ë‹¨í•œ í”¼ë¶€ 2": {
        grade: "í¬ê·€",
        imgId: "1XfdIrPSz_xm9v1KHB-TArpaRdv47zHLF",
        desc: "ì  ìœ ë‹›ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ í”¼í•´ {red_f}ë§Œí¼ ê°ì†Œ",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            red_f: 30 + (i - 1) * 2
          };
          return lv;
        })()
      },
      "í”¼í•´ ì €í•­ 2": {
        grade: "í¬ê·€",
        imgId: "13As5kbKRnyJA81fUClKxILhq8P9Rws0c",
        desc: "ì  ìœ ë‹›ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ {prob}% í™•ë¥ ë¡œ í”¼í•´ {red_f}ë§Œí¼ ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const p = [30, 30, 30, 30, 30, 35, 35, 35, 35, 35, 35, 35, 35, 35, 35, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 50];
          const v = [70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 124, 128, 132, 136, 150];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            red_f: v[i]
          });
          return lv;
        })()
      },
      "ì¹˜ëª…íƒ€ í™•ë¥ ": {
        grade: "ì—í”½",
        imgId: "1rZUa6JfGfbksXt1qOO32veoEty9er_Bu",
        desc: "ìœ ë‹› ì¹˜ëª…íƒ€ í™•ë¥  {prob}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [13, 13.3, 13.6, 13.9, 14.2, 17, 17.3, 17.6, 17.9, 18.2, 21, 21.3, 21.6, 21.9, 22.2, 25, 25.5, 26, 26.5, 27, 30, 30.5, 31, 31.5, 32, 35, 35.5, 36, 36.5, 37, 40];
          v.forEach((x, i) => lv[i + 1] = {
            crit_p: x
          });
          return lv;
        })()
      },
      "ì¹˜ëª…íƒ€ í”¼í•´": {
        grade: "ì—í”½",
        imgId: "127l8ExJLlQENOySkwk_TiNDLO5gKo7Rm",
        desc: "ìœ ë‹› ì¹˜ëª…íƒ€ í”¼í•´ëŸ‰ {crit_d}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [20, 20.5, 21, 21.5, 22, 25, 25.5, 26, 26.5, 27, 30, 30.5, 31, 31.5, 32, 35, 36, 37, 38, 39, 42, 43, 44, 45, 46, 50, 51, 52, 53, 54, 60];
          v.forEach((x, i) => lv[i + 1] = {
            crit_d: x
          });
          return lv;
        })()
      },
      "ê³µê²©ë ¥ ì¦ê°€ 3": {
        grade: "ì—í”½",
        imgId: "1MBbzM8Snw4awmVoS-mBe1ATN_WlkcwqL",
        desc: "ìœ ë‹› ê³µê²©ë ¥ {atk_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 62, 64, 66, 68, 75];
          v.forEach((x, i) => lv[i + 1] = {
            atk_f: x
          });
          return lv;
        })()
      },
      "ì²´ë ¥ ì¦ê°€ 3": {
        grade: "ì—í”½",
        imgId: "1r_tPl7V2ydsAD3p_amPfL1d92i-6AFLN",
        desc: "ìœ ë‹› ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [875, 900, 925, 950, 975, 1000, 1025, 1050, 1075, 1100, 1125, 1150, 1175, 1200, 1225, 1250, 1275, 1300, 1325, 1350, 1375, 1400, 1425, 1450, 1475, 1500, 1550, 1600, 1650, 1700, 1875];
          v.forEach((x, i) => lv[i + 1] = {
            hp_f: x
          });
          return lv;
        })()
      },
      "ì£½ì„ ì¤€ë¹„": {
        grade: "ì—í”½",
        imgId: "1x77384PZAogZ_hTJeRH1iLXPrOfM5e_g",
        desc: "ì‚¬ë§ ì‹œ {prob}% í™•ë¥ ë¡œ í˜„ì¬ ì „íˆ¬ì¤‘ì¸ ìœ ë‹›ì—ê²Œ ë‚˜ì˜ ìœ ë‹›ì˜ ê³µê²©ë ¥ì˜ {burst_p}% í”¼í•´",
        levels: (function() {
          let lv = {};
          const p = [80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 85, 85, 85, 85, 85, 85, 85, 85, 85, 85, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 100];
          const v = [50, 51, 52, 53, 54, 60, 61, 62, 63, 64, 66, 67, 68, 69, 70, 76, 77, 78, 79, 80, 82, 83, 84, 85, 86, 90, 91, 92, 93, 94, 100];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            burst_p: v[i]
          });
          return lv;
        })()
      },
      "ì••ì¶•ëœ í˜": {
        grade: "ì—í”½",
        imgId: "1aaijjlcR-GjrDeZy4WzBqFN2J7oBiw2C",
        desc: "ìœ ë‹›ì˜ í¬ê¸°ê°€ ì‘ì•„ì§€ë©° ìœ ë‹›ì˜ ê³µê²©ë ¥ì´ {atk_p}% ì¦ê°€í•˜ê³  ìµœëŒ€ ì²´ë ¥ì´ 25% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const v = [15, 15.2, 15.4, 15.6, 15.8, 17, 17.5, 18, 18.5, 19, 22, 22.5, 23, 23.5, 24, 27, 27.5, 28, 28.5, 29, 33, 33.5, 34, 34.5, 35, 39, 39.5, 40, 40.5, 41, 45];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x,
            hp_p: -25
          });
          return lv;
        })()
      },
      "ë§¤ë¨¸ë“œì˜ í˜": {
        grade: "ì—í”½",
        imgId: "14UVrJVEIr5xZghRiG96doS_QhOQ0VxBK",
        desc: "ìœ ë‹›ì˜ í¬ê¸°ê°€ ì»¤ì§€ë©° ìœ ë‹›ì˜ ì²´ë ¥ì´ {hp_p}% ì¦ê°€í•˜ê³  ê³µê²©ë ¥ì´ 25% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          const v = [19.5, 20, 20.5, 21, 21.5, 27, 27.5, 28, 28.5, 29, 34.5, 35.5, 36.5, 37.5, 38.5, 44.5, 45.8, 47, 48.3, 49.5, 59.5, 60.8, 62, 63.3, 64.5, 79.5, 80.8, 82, 83.3, 84.5, 102];
          v.forEach((x, i) => lv[i + 1] = {
            hp_p: x,
            atk_p: -25
          });
          return lv;
        })()
      },
      "í¡í˜ˆ": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1wpM4jrjnyShM9jkrWQuleCMRQzqajRg-",
        desc: "ìœ ë‹›ì„ ê³µê²©í•  ë•Œ {prob}% í™•ë¥ ë¡œ ë‚´ ìœ ë‹› ê³µê²©ë ¥ì˜ {rec_p}% ë§Œí¼ ì²´ë ¥ íšŒë³µ",
        levels: (function() {
          let lv = {};
          const p = [15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 30];
          const v = [30, 32, 34, 36, 38, 45, 47, 49, 51, 53, 55, 57, 59, 61, 63, 70, 72, 74, 76, 78, 80, 82, 84, 86, 88, 95, 97, 99, 101, 103, 110];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            rec_p: v[i]
          });
          return lv;
        })()
      },
      "ê°•íƒ€": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1duFRCFWSfwJIT4FcOfDcJU5t9_sYYSNd",
        desc: "ìœ ë‹› ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [7, 7.2, 7.4, 7.6, 7.8, 10, 10.2, 10.4, 10.6, 10.8, 13, 13.4, 13.8, 14.2, 14.6, 17, 17.5, 18, 18.5, 19, 23, 23.5, 24, 24.5, 25, 31, 31.5, 32, 32.5, 33, 40];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x
          });
          return lv;
        })()
      },
      "ë°©ì–´ë²½": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "19nNX-o2m8lDQfKLe5YXd7JijVf7HK0iI",
        desc: "ìœ ë‹› ì²´ë ¥ {hp_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [17.5, 18, 18.5, 19, 19.5, 25, 25.5, 26, 26.5, 27, 32.5, 33.5, 34.5, 35.5, 36.5, 42.5, 43.8, 45, 46.3, 47.5, 57.5, 58.8, 60, 61.3, 62.5, 77.5, 78.8, 80, 81.3, 82.5, 100];
          v.forEach((x, i) => lv[i + 1] = {
            hp_p: x
          });
          return lv;
        })()
      },
      "ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1UaNaWoiuUASIRx62ixYoUTleH-wc_gFI",
        desc: "ë³´ìŠ¤ë¥¼ ê³µê²©í•  ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const v = [20, 22, 24, 26, 28, 40, 42, 44, 46, 48, 60, 62, 64, 66, 68, 80, 83, 86, 89, 92, 110, 115, 120, 125, 130, 150, 160, 170, 180, 190, 250];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x
          });
          return lv;
        })()
      },
      "ë©”í…Œì˜¤": {
        grade: "ì „ì„¤",
        imgId: "1fJVyoKiTVH1i0votjXaXuwAbTZjxnM-P",
        desc: "ìœ ë‹›ì„ ê³µê²©í•  ë•Œ {prob}% í™•ë¥ ë¡œ í˜„ì¬ íƒ€ì¼ì— ìˆëŠ” ëª¨ë“  ì ì—ê²Œ ê³µê²©ë ¥ì˜ {burst_p}% ìŠ¤í‚¬ ì¶”ê°€ í”¼í•´\në ˆì „ë”ë¦¬ íŒ¨ì‹œë¸Œ : ê³µê²©ë ¥ {atk_p}%, ì²´ë ¥ {hp_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const p = [50, 50, 50, 50, 50, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 55, 60, 60, 60, 60, 60, 65];
          const v = [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 40, 41, 42, 43, 44, 50, 51, 52, 53, 54, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 80];
          const pas = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 10];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            burst_p: v[i],
            atk_p: pas[i],
            hp_p: pas[i]
          });
          return lv;
        })()
      },
      "ë‚™ë¢°": {
        grade: "ì „ì„¤",
        imgId: "1pPUwyTblvZJDbTAPUOJYr8hdUqPTZmy4",
        desc: "ìœ ë‹›ì„ ê³µê²©í•  ë•Œ {prob}% í™•ë¥ ë¡œ ì „íˆ¬ì¤‘ì¸ ìƒëŒ€ ìœ ë‹›ì—ê²Œ {burst_p}% ìŠ¤í‚¬ ì¶”ê°€ í”¼í•´\në ˆì „ë”ë¦¬ íŒ¨ì‹œë¸Œ : ê³µê²©ë ¥ {atk_p}%, ì²´ë ¥ {hp_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          const p = [40, 40, 40, 40, 40, 45, 45, 45, 45, 45, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 60, 60, 60, 60, 60, 65, 65, 65, 65, 65, 65];
          const v = [40, 40.5, 41, 41.5, 42, 50, 50.5, 51, 51.5, 52, 67.5, 68, 68.5, 69, 69.5, 82.5, 83, 83.5, 84, 84.5, 90, 90.5, 91, 91.5, 92, 100, 100.5, 101, 101.5, 102, 115];
          const pas = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 10];
          p.forEach((x, i) => lv[i + 1] = {
            prob: x,
            burst_p: v[i],
            atk_p: pas[i],
            hp_p: pas[i]
          });
          return lv;
        })()
      },
      // ë¶€ì í•© ë£¬ ëª©ë¡ (ë°ì´í„° ì¶”ê°€ë¨)
      "ìŠ¹ë¦¬ì˜ í•¨ì„±": {
        grade: "ì¼ë°˜",
        imgId: "1kdYTPMnC9sHD_xVfJ7KlMEAmepKrI5U3",
        desc: "ì  ìœ ë‹›ì„ ì²˜ì¹˜ ì‹œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_p}% ë²„í”„ {turn}í„´ ì§€ì†",
        levels: (function() {
          let lv = {};
          const v = [1.0, 1.2, 1.4, 1.6, 1.8, 2.0, 2.2, 2.4, 2.6, 2.8, 3.0, 3.2, 3.4, 3.6, 3.8, 4.0, 4.2, 4.4, 4.6, 4.8, 5.0, 5.2, 5.4, 5.6, 5.8, 6.0, 6.2, 6.4, 6.6, 6.8, 7.5];
          const t = [3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8];
          v.forEach((x, i) => lv[i + 1] = {
            atk_p: x,
            turn: t[i]
          });
          return lv;
        })()
      },
      "ìì—°ì˜ í¬ì˜¹": {
        grade: "ì¼ë°˜",
        imgId: "11shDd_9139ob8f3NJpu51kASPqzfDZTF",
        desc: "ìì—° êµ¬ì¡°ë¬¼(ì±„ì§‘ì§€ ì œì™¸)ì´ ìˆëŠ” íƒ€ì¼ ì˜†ì— ìˆì„ ê²½ìš° ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_f} ì²´ë ¥ {hp_f} ë²„í”„",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: i,
            hp_f: i * 25
          };
          return lv;
        })()
      },
      "íŒŒê´´ì 1": {
        grade: "ì¼ë°˜",
        imgId: "1gEKQmAPtu3APq91BSK7YlUldIkPQQKV3",
        desc: "ê±´ì¶•ë¬¼ì„ ê³µê²©í•  ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) {
            let atk_p;
            if (i <= 5) atk_p = 5.1 + (i - 1) * 3;
            else if (i <= 10) atk_p = 7.5 + (i - 6) * 3;
            else if (i <= 15) atk_p = 9.9 + (i - 11) * 3;
            else if (i <= 20) atk_p = 13.2 + (i - 16) * 3;
            else if (i <= 25) atk_p = 17.1 + (i - 21) * 6;
            else if (i <= 30) atk_p = 23.1 + (i - 26) * 6;
            else atk_p = 30;
            lv[i] = {
              atk_p: parseFloat(atk_p.toFixed(1))
            };
          }
          return lv;
        })()
      },
      "ê°•ì¸í•¨ 1": {
        grade: "ì¼ë°˜",
        imgId: "1USRrGEG4SiMnOwYYV_IYy0hllT6fXNhN",
        desc: "ê±´ì¶•ë¬¼ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ í”¼í•´ {red_f} ê°ì†Œ",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            red_f: i
          };
          return lv;
        })()
      },
      "ë¶€ì¡±ì˜ ì¶•ë³µ 1": {
        grade: "ì¼ë°˜",
        imgId: "19K30pdy48M0_TW7kR5Iz8Cxbx5NxYVkX",
        desc: "ë‚´ ë¶€ì¡±ì´ ì ë ¹í•œ íƒ€ì¼ ìœ„ì— ìˆì„ ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_f} ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: i,
            hp_f: i * 25
          };
          return lv;
        })()
      },
      "íŒŒê´´ì 2": {
        grade: "í¬ê·€",
        imgId: "1XWpJQ3PShBg43fHvfVgf1f8t0pDoD5mj",
        desc: "ê±´ì¶•ë¬¼ì„ ê³µê²©í•  ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) {
            let atk_p;
            if (i <= 5) atk_p = 11.9 + (i - 1) * 0.7;
            else if (i <= 10) atk_p = 17.5 + (i - 6) * 0.7;
            else if (i <= 15) atk_p = 23.1 + (i - 11) * 0.7;
            else if (i <= 20) atk_p = 30.5 + (i - 16) * 0.7;
            else if (i <= 25) atk_p = 39.9 + (i - 21) * 1.4;
            else if (i <= 30) atk_p = 53.9 + (i - 26) * 1.4;
            else atk_p = 70;
            lv[i] = {
              atk_p: parseFloat(atk_p.toFixed(1))
            };
          }
          return lv;
        })()
      },
      "ë¶€ì¡±ì˜ ì¶•ë³µ 2": {
        grade: "í¬ê·€",
        imgId: "1EIJibIbgJ2EXyMhJT59cSWNACb-ROxxv",
        desc: "ë‚´ ë¶€ì¡±ì´ ì ë ¹í•œ íƒ€ì¼ ìœ„ì— ìˆì„ ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_f} ì²´ë ¥ {hp_f} ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) lv[i] = {
            atk_f: 15 + (i - 1),
            hp_f: 375 + (i - 1) * 25
          };
          return lv;
        })()
      },
      "íŒŒê´´ì 3": {
        grade: "ì—í”½",
        imgId: "1sSwqcPHGFhZIR1i-UfwHuU34NvvDPwN2",
        desc: "ê±´ì¶•ë¬¼ì„ ê³µê²©í•  ë•Œ ìœ ë‹›ì˜ ê³µê²©ë ¥ {atk_p}% ì¦ê°€",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) {
            let atk_p;
            if (i <= 5) atk_p = 28.0 + (i - 1) * 0.8;
            else if (i <= 10) atk_p = 40.0 + (i - 6) * 0.8;
            else if (i <= 15) atk_p = 52.0 + (i - 11) * 1.6;
            else if (i <= 20) atk_p = 68.0 + (i - 16) * 2.0;
            else if (i <= 25) atk_p = 92.0 + (i - 21) * 2.0;
            else if (i <= 30) atk_p = 124.0 + (i - 26) * 2.0;
            else atk_p = 160.0;
            lv[i] = {
              atk_p: parseFloat(atk_p.toFixed(1))
            };
          }
          return lv;
        })()
      },
      "ê°•ì¸í•¨ 2": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "12R07txrHKhMhwoxbE4M-QBw4mxxOUTxf",
        desc: "ê±´ì¶•ë¬¼ì—ê²Œ ê³µê²©ë‹¹í•  ë•Œ í”¼í•´ {red_p}% ê°ì†Œ",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) {
            let red_p;
            if (i <= 5) red_p = 30.0 + (i - 1) * 0.5;
            else if (i <= 10) red_p = 35.0 + (i - 6) * 0.5;
            else if (i <= 15) red_p = 40.0 + (i - 11) * 0.5;
            else if (i <= 20) red_p = 45.0 + (i - 16) * 0.5;
            else if (i <= 25) red_p = 50.0 + (i - 21) * 0.5;
            else if (i <= 30) red_p = 55.0 + (i - 26) * 0.5;
            else red_p = 60.0;
            lv[i] = {
              red_p: parseFloat(red_p.toFixed(1))
            };
          }
          return lv;
        })()
      },
      "ì§€ì§„": {
        grade: "ìœ ë‹ˆí¬",
        imgId: "1qH0wEmw_otlxQBBofd-H4kuA2SMKIVKn",
        desc: "ì  ê±´ì¶•ë¬¼ ëŒ€ìƒ {count}ë²ˆì§¸ ê³µê²©ë§ˆë‹¤ ì£¼ë³€ 1ì¹¸ íƒ€ì¼ì— ìˆëŠ” ì  ê±´ì¶•ë¬¼ê¹Œì§€ ê±´ì¶•ë¬¼ ëŒ€ìƒ ìµœì¢… í”¼í•´ëŸ‰ì˜ {burst_p}%ë§Œí¼ í”¼í•´ë¥¼ ì¤ë‹ˆë‹¤.",
        levels: (function() {
          let lv = {};
          for (let i = 1; i <= 31; i++) {
            let burst_p, count;
            count = (i >= 21) ? 3 : 4;
            if (i <= 5) burst_p = 200 + (i - 1) * 10;
            else if (i <= 10) burst_p = 270 + (i - 6) * 10;
            else if (i <= 15) burst_p = 340 + (i - 11) * 10;
            else if (i <= 20) burst_p = 410 + (i - 16) * 10;
            else if (i <= 25) burst_p = 450 + (i - 21) * 10;
            else if (i <= 30) burst_p = 530 + (i - 26) * 10;
            else burst_p = 600;
            lv[i] = {
              burst_p: burst_p,
              count: count
            };
          }
          return lv;
        })()
      },
    };
    //ë£¬ ë°ì´í„° ì¢…ë£Œ
    // --- ë£¬ ì„¤ëª… ìƒ‰ìƒ ì„¤ì • ë° ë³€í™˜ ë¡œì§ ì¶”ê°€ ---
    const RUNE_STYLE_CONFIG = {
      "#ba0000": ["atk_f", "atk_p", "burst_p", "crit_d"], // ë¹¨ê°• (ì „ì„¤ ë“±ê¸‰ìƒ‰) - ê³µê²©
      "#66bb6a": ["hp_f", "hp_p", "rec_p", "value"], // ì´ˆë¡ (í¬ê·€ ë“±ê¸‰ìƒ‰) - ì²´ë ¥/íšŒë³µ
      "#eb5f0e": ["red_f", "red_p"], // ì£¼í™© (ìœ ë‹ˆí¬ ë“±ê¸‰ìƒ‰) - í”¼í•´ ê°ì†Œ
      "#ff9800": ["prob", "turn", "count"] // ë…¸ë‘ (ì—í”½ ë“±ê¸‰ìƒ‰) - í™•ë¥ /í„´
    };
    const RUNE_COLOR_MAP = {};
    for (const [color, keys] of Object.entries(RUNE_STYLE_CONFIG)) {
      keys.forEach(key => RUNE_COLOR_MAP[key] = color);
    }
    const RUNE_TAG_REGEX = /\{(\w+)\}/g;

    function getFormattedDesc(runeName, level) {
      const rune = RUNES_DATA[runeName];
      if (!rune || !rune.levels[level]) return "";
      const stats = rune.levels[level];
      return rune.desc.replace(RUNE_TAG_REGEX, (match, key) => {
        const value = stats[key];
        if (value === undefined) return match;
        const color = RUNE_COLOR_MAP[key] || "#fff";
        return `<span style="color: ${color}; font-weight: bold;">${value}</span>`;
      });
    }
    // ------------------------------------------
    const titanStats = [];
    const unsuitableList = ["ê°•ì¸í•¨ 1", "ê°•ì¸í•¨ 2", "ìì—°ì˜ í¬ì˜¹", "ìŠ¹ë¦¬ì˜ í•¨ì„±", "ë¶€ì¡±ì˜ ì¶•ë³µ 1", "ë¶€ì¡±ì˜ ì¶•ë³µ 2", "íŒŒê´´ì 1", "íŒŒê´´ì 2", "íŒŒê´´ì 3", "ì§€ì§„"];
    const vampExclusion = ["ê³ ë…í•œ ë¶„ë…¸", "í˜‘ë™ ê³µê²©", "ë§ˆì§€ë§‰ ì„ ë¬¼", "ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´"];
    let selectedRunes = [null, null, null, null, null];
    let activeSlotIdx = null;
    let tempName = "";
    // ëª¨ë“  ì„¤ì •ê°’ ì €ì¥ í•¨ìˆ˜
    function saveUserConfig() {
      const config = {
        baseAtk: document.getElementById('baseAtk').value,
        baseHp: document.getElementById('baseHp').value,
        dinoCount: document.getElementById('dinoCount').value,
        titanLevel: document.getElementById('titanLevelSelect').value,
        timeLimit: document.getElementById('timeLimitSelect').value,
        selectedRunes: selectedRunes // [ {name, lv}, ... ]
      };
      localStorage.setItem('dino_sim_config', JSON.stringify(config));
    }
    // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
    function loadUserConfig() {
      const saved = localStorage.getItem('dino_sim_config');
      if (!saved) return;
      const config = JSON.parse(saved);
      // ê¸°ë³¸ ì •ë³´ ë³µêµ¬
      document.getElementById('baseAtk').value = config.baseAtk;
      document.getElementById('baseHp').value = config.baseHp;
      document.getElementById('dinoCount').value = config.dinoCount;
      // 1. íƒ€ì´íƒ„ ë ˆë²¨ ë³µêµ¬ ë° ë¼ë²¨ ê°±ì‹ 
      const tLevel = config.titanLevel || 1;
      document.getElementById('titanLevelSelect').value = tLevel;
      if (titanStats[tLevel]) {
        const atk = titanStats[tLevel].atk;
        const hp = titanStats[tLevel].hp.toLocaleString();
        document.querySelector('#titanDropdown .selected-value').textContent = `Lv. ${tLevel} (ATK ${atk} / HP ${hp})`;
      }
      // 2. ì‹œê°„ ì œí•œ ë³µêµ¬ ë° ë¼ë²¨ ê°±ì‹ 
      const tLimit = config.timeLimit || 90;
      document.getElementById('timeLimitSelect').value = tLimit;
      document.querySelector('#timeDropdown .selected-value').textContent = `${tLimit}ë¶„`;
      // ë£¬ ìŠ¬ë¡¯ ë³µêµ¬
      if (config.selectedRunes) {
        selectedRunes = config.selectedRunes;
        selectedRunes.forEach((rune, idx) => {
          const slot = document.getElementById(`slot-${idx}`);
          if (rune && rune.name && RUNES_DATA[rune.name]) {
            slot.innerHTML = `
                    <img src="${getImgUrl(RUNES_DATA[rune.name].imgId)}" class="slot-img">
                    <div class="slot-lv-tag">Lv.${rune.lv}</div>`;
          } else {
            slot.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${idx+1}</span>`;
          }
        });
      }
      calcFinal(); // í™”ë©´ ìŠ¤íƒ¯ ê°±ì‹ 
    }
    window.onload = () => {
      // 1. íƒ€ì´íƒ„ ë°ì´í„° ë° ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ëª©ë¡ ìƒì„±
      const titanList = document.getElementById('titanList');
      for (let lv = 1; lv <= 50; lv++) {
        let atk, hp;
        if (lv <= 6) {
          atk = lv * 5;
          hp = 2500000 * lv;
        } else if (lv <= 10) {
          atk = 30 + (lv - 6) * 15;
          const hps = {
            7: 20625000,
            8: 24375000,
            9: 28125000,
            10: 31875000
          };
          hp = hps[lv];
        } else {
          atk = 90 + (lv - 10) * 15;
          hp = 31875000 + (lv - 10) * 3750000;
        }
        titanStats[lv] = {
          atk,
          hp
        };
        // ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ìš© <li> ìƒì„±
        const li = document.createElement('li');
        const label = `Lv. ${lv} (ATK ${atk} / HP ${hp.toLocaleString()})`;
        li.textContent = label;
        li.onclick = () => {
          document.querySelector('#titanDropdown .selected-value').textContent = label;
          document.getElementById('titanLevelSelect').value = lv; // hidden inputì— ì €ì¥
          titanList.style.display = 'none';
          saveUserConfig();
        };
        titanList.appendChild(li);
      }
      // 2. ì‹œê°„ ì œí•œ ëª©ë¡ ìƒì„± (10~120ë¶„)
      const timeList = document.getElementById('timeList');
      for (let m = 10; m <= 120; m += 10) {
        const li = document.createElement('li');
        li.textContent = `${m}ë¶„`;
        li.onclick = () => {
          document.querySelector('#timeDropdown .selected-value').textContent = `${m}ë¶„`;
          document.getElementById('timeLimitSelect').value = m; // hidden inputì— ì €ì¥
          timeList.style.display = 'none';
          saveUserConfig();
        };
        timeList.appendChild(li);
      }
      // 3. ê³µë£¡ ë§ˆë¦¬ìˆ˜ (ê¸°ì¡´ select ìœ ì§€)
      const dCount = document.getElementById('dinoCount');
      for (let i = 1; i <= 9; i++) dCount.add(new Option(`${i}ë§ˆë¦¬`, i));
      // 4. ë£¬ ìŠ¬ë¡¯ ìƒì„±
      const sc = document.getElementById('slotContainer');
      for (let i = 0; i < 5; i++) {
        const div = document.createElement('div');
        div.className = 'slot';
        div.id = `slot-${i}`;
        div.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${i+1}</span>`;
        div.onclick = () => openPicker(i);
        sc.appendChild(div);
      }
      // 5. ë£¬ ê·¸ë¦¬ë“œ ìƒì„±
      const mainGrid = document.getElementById('mainGrid');
      const unsuitableGrid = document.getElementById('unsuitableGrid');
      Object.keys(RUNES_DATA).forEach(name => {
        const r = RUNES_DATA[name];
        const isUn = unsuitableList.includes(name);
        const item = document.createElement('div');
        item.className = 'rune-item';
        item.innerHTML = `<div class="rune-img-container" style="border-color:var(--${r.grade})"><img src="${getImgUrl(r.imgId)}"></div><div class="rune-label">${name}</div>`;
        item.onclick = () => showDetail(name);
        if (isUn) unsuitableGrid.appendChild(item);
        else mainGrid.appendChild(item);
      });
      // 6. ë£¬ ë ˆë²¨ ì…€ë ‰íŠ¸ (ê¸°ì¡´ select ìœ ì§€)
      const ls = document.getElementById('levelSelect');
      for (let i = 1; i <= 31; i++) ls.add(new Option(`Lv.${i}`, i));
      ls.onchange = () => updateDetail(tempName, ls.value);
      // 7. ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
      loadUserConfig();
    };

    function openPicker(idx) {
      const picker = document.getElementById('runePicker');
      const isSameSlot = (activeSlotIdx === idx);
      if (isSameSlot && picker.style.display === 'block') {
        picker.style.display = 'none';
        activeSlotIdx = null;
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('active'));
      } else {
        activeSlotIdx = idx;
        picker.style.display = 'block';
        document.querySelectorAll('.slot').forEach((s, i) => {
          s.classList.toggle('active', i === idx);
        });
        // ì¶”ê°€ëœ ì½”ë“œ: ì°½ì´ ì—´ë¦´ ë•Œ ë£¬ í”¼ì»¤ ìœ„ì¹˜ë¡œ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤
        // block: 'nearest'ëŠ” í™”ë©´ì— ì´ë¯¸ ë³´ì´ë©´ ì›€ì§ì´ì§€ ì•Šê³ , ê°€ë ¤ì ¸ ìˆìœ¼ë©´ ìµœì†Œí•œìœ¼ë¡œ ì›€ì§ì…ë‹ˆë‹¤.
        picker.scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
        });
      }
    }

    function showDetail(name) {
      tempName = name;
      const r = RUNES_DATA[name];
      document.getElementById('runeDetail').style.display = 'block';
      document.getElementById('detailName').innerText = name;
      document.getElementById('detailGrade').innerText = r.grade;
      document.getElementById('detailGrade').style.color = `var(--${r.grade})`;
      updateDetail(name, document.getElementById('levelSelect').value);
    }

    function updateDetail(name, lv) {
      const r = RUNES_DATA[name];
      const s = r.levels[lv];
      let d = r.desc || "";
      if (s) {
        // {key} í˜•íƒœì˜ íƒœê·¸ë¥¼ ì°¾ì•„ ë§¤í•‘ëœ ìƒ‰ìƒê³¼ ìˆ˜ì¹˜ë¡œ ì¹˜í™˜
        d = d.replace(/\{(\w+)\}/g, (match, key) => {
          const value = s[key];
          if (value === undefined) return match;
          const color = RUNE_COLOR_MAP[key] || "#fff"; // ë§¤í•‘ ì—†ìœ¼ë©´ í°ìƒ‰
          return `<span style="color: ${color}; font-weight: bold;">${value}</span>`;
        });
      }
      document.getElementById('detailDesc').innerHTML = d;
    }
    // 1. ì¤‘ë³µ ì²´í¬ ë° ì¥ì°© ë¡œì§
    function applyRuneToSlot() {
      const lv = document.getElementById('levelSelect').value;
      const slot = document.getElementById(`slot-${activeSlotIdx}`);
      // --- [ì¶”ê°€] ì••ì¶•ëœ í˜ vs ë§¤ë¨¸ë“œì˜ í˜ ìƒí˜¸ ë°°íƒ€ì  ì²´í¬ ---
      if (tempName === "ì••ì¶•ëœ í˜" && selectedRunes.some(r => r && r.name === "ë§¤ë¨¸ë“œì˜ í˜")) {
        alert("'ë§¤ë¨¸ë“œì˜ í˜'ê³¼ 'ì••ì¶•ëœ í˜'ì€ ë™ì‹œì— ì¥ì°©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      if (tempName === "ë§¤ë¨¸ë“œì˜ í˜" && selectedRunes.some(r => r && r.name === "ì••ì¶•ëœ í˜")) {
        alert("'ì••ì¶•ëœ í˜'ê³¼ 'ë§¤ë¨¸ë“œì˜ í˜'ì€ ë™ì‹œì— ì¥ì°©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      // ë™ì¼ ë£¬ì´ ì´ë¯¸ ë‹¤ë¥¸ ìŠ¬ë¡¯ì— ìˆëŠ”ì§€ ì²´í¬í•˜ì—¬ ì œê±°
      selectedRunes.forEach((rune, idx) => {
        if (rune && rune.name === tempName) {
          selectedRunes[idx] = null;
          const otherSlot = document.getElementById(`slot-${idx}`);
          otherSlot.textContent = '';
          otherSlot.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${idx+1}</span>`;
        }
      });
      // ë°ì´í„° ì €ì¥
      selectedRunes[activeSlotIdx] = {
        name: tempName,
        lv: lv
      };
      // DOM ì—…ë°ì´íŠ¸: ì•ˆì „í•˜ê²Œ ë¹„ìš°ê³  ì‚½ì…
      slot.textContent = '';
      slot.innerHTML = `
        <img src="${getImgUrl(RUNES_DATA[tempName].imgId)}" class="slot-img">
        <div class="slot-lv-tag">Lv.${lv}</div>`;
      document.getElementById('runePicker').style.display = 'none';
      calcFinal();
      saveUserConfig();
    }
    // 2. ì¥ì°© í•´ì œ ë¡œì§
    function removeRuneFromSlot() {
      if (activeSlotIdx === null) return;
      selectedRunes[activeSlotIdx] = null;
      const slot = document.getElementById(`slot-${activeSlotIdx}`);
      // ì•ˆì „í•˜ê²Œ ë¹„ìš°ê³  ê¸°ë³¸ í…ìŠ¤íŠ¸ ì‚½ì…
      slot.textContent = '';
      slot.innerHTML = `<span style="font-size:10px; color:#aaa;">ìŠ¬ë¡¯ ${activeSlotIdx+1}</span>`;
      document.getElementById('runePicker').style.display = 'none';
      calcFinal();
      saveUserConfig();
    }
    // 3. ìƒì„¸ ì •ë³´ í‘œì‹œ ë° ìë™ ìŠ¤í¬ë¡¤
    function showDetail(name) {
      tempName = name;
      const r = RUNES_DATA[name];
      const detailView = document.getElementById('runeDetail');
      detailView.style.display = 'block';
      document.getElementById('detailName').innerText = name;
      document.getElementById('detailGrade').innerText = r.grade;
      document.getElementById('detailGrade').style.color = `var(--${r.grade})`;
      updateDetail(name, document.getElementById('levelSelect').value);
      // í•˜ë‹¨ ìƒì„¸ì°½ìœ¼ë¡œ ìë™ ìŠ¤í¬ë¡¤
      detailView.scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
      });
    }
    // ì „íˆ¬ ìŠ¤íƒ¯ ê³„ì‚° (ë³´ìŠ¤ ìŠ¬ë ˆì´ì–´ ë° ì •ìˆ˜/í¼ì„¼íŠ¸ í•©ì‚°)
    let isDefenseExpected = false; // í”¼í•´ ê°ì†Œ ê¸°ëŒ€ê°’ ëª¨ë“œ ì—¬ë¶€
    let isVampExpected = false; // í¡í˜ˆ ê¸°ëŒ€ê°’ ëª¨ë“œ ì—¬ë¶€
    function getBattleStats() {
      const bAtk = Number(document.getElementById('baseAtk').value);
      const bHp = Number(document.getElementById('baseHp').value);
      const count = Number(document.getElementById('dinoCount').value);
      let atkF = 0,
        atkP = 0,
        hpF = 0,
        hpP = 0,
        cRate = 3,
        cDmg = 105;
      // ì¶”ê°€ ìŠ¤íƒ¯ ë³€ìˆ˜
      let redF = 0; // ë‹¨ë‹¨í•œ í”¼ë¶€ í•©ì‚°
      let resProb1 = 0,
        resVal1 = 0,
        resProb2 = 0,
        resVal2 = 0; // í”¼í•´ ì €í•­ ìŠ¤íƒ¯
      let vProb = 0,
        vRecP = 0; // í¡í˜ˆ ìŠ¤íƒ¯
      // í¡í˜ˆ ê¸°ì¤€ ê³µê²©ë ¥(vampBaseAtk) ê³„ì‚°ìš© ë³€ìˆ˜
      let atkF_vamp = 0,
        atkP_vamp = 0;
      selectedRunes.forEach(r => {
        if (!r) return;
        const s = RUNES_DATA[r.name].levels[r.lv];
        // 1. ê¸°ë³¸ ê³µê²©ë ¥/ì²´ë ¥ ì¡°ê±´ë¶€ í•©ì‚°
        let active = (r.name === "í˜‘ë™ ê³µê²©" ? count >= 5 : (r.name === "ê³ ë…í•œ ë¶„ë…¸" ? count === 1 : true));
        if (active) {
          if (s.atk_f) atkF += s.atk_f;
          if (s.atk_p) atkP += s.atk_p;
          if (s.hp_f) hpF += s.hp_f;
          if (s.hp_p) hpP += s.hp_p;
        }
        // 2. í¡í˜ˆ ì „ìš© ê³µê²©ë ¥ í•©ì‚° (í˜‘ë™/ê³ ë… ì œì™¸)
        if (!vampExclusion.includes(r.name)) {
          if (s.atk_f) atkF_vamp += s.atk_f;
          if (s.atk_p) atkP_vamp += s.atk_p;
        }
        // 3. ì¹˜ëª…íƒ€ ë° ê¸°íƒ€ ìŠ¤íƒ¯
        if (r.name === "ì¹˜ëª…íƒ€ í™•ë¥ ") cRate += s.prob;
        if (r.name === "ì¹˜ëª…íƒ€ í”¼í•´") cDmg += s.crit_d;
        // 4. í”¼í•´ ê°ì†Œ/ì €í•­ í•©ì‚°
        if (r.name.includes("ë‹¨ë‹¨í•œ í”¼ë¶€")) redF += s.red_f;
        if (r.name === "í”¼í•´ ì €í•­ 1") {
          resProb1 = s.prob;
          resVal1 = s.red_f;
        }
        if (r.name === "í”¼í•´ ì €í•­ 2") {
          resProb2 = s.prob;
          resVal2 = s.red_f;
        }
        // 5. í¡í˜ˆ í•©ì‚°
        if (r.name === "í¡í˜ˆ") {
          vProb = s.prob;
          vRecP = s.rec_p;
        }
      });
      // í¡í˜ˆ ê¸°ì¤€ ê³µê²©ë ¥ ë° 1íšŒ íšŒë³µëŸ‰ ê³„ì‚°
      const vBaseAtk = (bAtk + atkF_vamp) * (1 + atkP_vamp / 100);
      const singleVamp = vBaseAtk * (vRecP / 100);
      return {
        fAtk: (bAtk + atkF) * (1 + atkP / 100),
        fHp: (bHp + hpF) * (1 + hpP / 100),
        cRate,
        cDmg,
        // í”¼í•´ ê°ì†Œ ê´€ë ¨
        redF,
        resTotal: resVal1 + resVal2,
        resExpected: (resVal1 * resProb1 / 100) + (resVal2 * resProb2 / 100),
        // í¡í˜ˆ ê´€ë ¨
        vProb,
        vampAmount: singleVamp,
        vampExpected: (vBaseAtk * (vRecP / 100)) * (vProb / 100) * 3
      };
    }

    function calcFinal() {
      const s = getBattleStats();
      // 1. ê¸°ë³¸ ê³µê²©ë ¥/ì²´ë ¥ ì¶œë ¥
      document.getElementById('resAtk').innerText = Math.floor(s.fAtk).toLocaleString();
      document.getElementById('resHp').innerText = Math.floor(s.fHp).toLocaleString();
      // 2. í”¼í•´ ê°ì†ŒëŸ‰ ì¶œë ¥ (í´ë¦­ ì‹œ í† ê¸€)
      const resRedEl = document.getElementById('resRed');
      if (isDefenseExpected) {
        const totalExp = s.redF + s.resExpected;
        resRedEl.innerHTML = `${Math.floor(totalExp).toLocaleString()} <span style="font-size:0.75em; opacity:0.8;">(1íšŒ í”¼ê²©ë‹¹ ê¸°ëŒ€ê°’)</span>`;
      } else {
        resRedEl.innerText = `${s.redF.toLocaleString()} (+${s.resTotal})`;
      }
      // 3. í¡í˜ˆ íšŒë³µëŸ‰ ì¶œë ¥ (í´ë¦­ ì‹œ í† ê¸€)
      const resVampEl = document.getElementById('resVamp');
      if (isVampExpected) {
        resVampEl.innerHTML = `${Math.floor(s.vampExpected).toLocaleString()} <span style="font-size:0.75em; opacity:0.8;">(1íšŒ í”¼ê²©ë‹¹ ê¸°ëŒ€ê°’)</span>`;
      } else {
        resVampEl.innerText = s.vProb > 0 ? `${Math.floor(s.vampAmount).toLocaleString()} (${s.vProb}% í™•ë¥ )` : "0";
      }
      saveUserConfig();
    }
    // ëª¨ë“œ ì „í™˜ìš© í•¨ìˆ˜
    function toggleDefenseMode() {
      isDefenseExpected = !isDefenseExpected;
      calcFinal();
    }

    function toggleVampMode() {
      isVampExpected = !isVampExpected;
      calcFinal();
    }
    async function startSimulation() {
      const iterations = 500;
      const batchSize = 1;
      let completed = 0;
      detailedLogs = [];
      // í†µê³„ í•©ì‚°ìš© ë³€ìˆ˜ (ìµœì € ê¸°ë¡ ê´€ë ¨ ë³€ìˆ˜ ì œê±°)
      let totalTitanHp = 0,
        totalTime = 0,
        totalDead = 0,
        totalDmg = 0;
      const limitSec = Number(document.getElementById('timeLimitSelect').value) * 60;
      let timeSeriesHp = new Array(limitSec + 1).fill(0);
      let timeSeriesCount = new Array(limitSec + 1).fill(0);
      const btn = document.querySelector('.btn-simulate');
      const originalBtnText = "ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ âš”ï¸";
      btn.disabled = true;
      const bAtk = Number(document.getElementById('baseAtk').value);
      const bHp = Number(document.getElementById('baseHp').value);
      const tLv = document.getElementById('titanLevelSelect').value;
      const targetTitan = titanStats[tLv];
      const maxDino = Number(document.getElementById('dinoCount').value);
      const runes = selectedRunes.map(r => r ? {
        ...r,
        s: RUNES_DATA[r.name].levels[r.lv]
      } : null);
      let atkF_vamp = 0,
        atkP_vamp = 0;
      runes.forEach(r => {
        if (!r || (typeof vampExclusion !== 'undefined' && vampExclusion.includes(r.name))) return;
        if (r.s.atk_f) atkF_vamp += r.s.atk_f;
        if (r.s.atk_p) atkP_vamp += r.s.atk_p;
      });
      const vampBaseAtk = (bAtk + atkF_vamp) * (1 + atkP_vamp / 100);
      const runBatch = () => {
        const end = Math.min(completed + batchSize, iterations);
        for (let i = completed; i < end; i++) {
          let dinos = [];
          for (let dIdx = 0; dIdx < maxDino; dIdx++) {
            dinos.push({
              hp: 0,
              giftAtk: 0,
              giftSteps: 0,
              shieldSteps: 0,
              attackCount: 0
            });
          }
          let tHp = targetTitan.hp;
          let sessionTime = 0;
          let prevAliveCount = maxDino;
          let initialFullHp = 0;
          for (let t = 1; t <= limitSec; t++) {
            sessionTime = t;
            let aliveDinos = dinos.filter(d => d.hp > 0);
            let aliveCount = (t === 1) ? maxDino : aliveDinos.length;
            if (aliveCount <= 0) break;
            if (t > 1 && aliveCount < prevAliveCount) {
              if (prevAliveCount >= 5 && aliveCount < 5) {
                const coopRune = runes.find(r => r && r.name === "í˜‘ë™ ê³µê²©");
                if (coopRune && coopRune.s.hp_f) {
                  dinos.forEach(d => {
                    if (d.hp > 0) d.hp = Math.max(0, d.hp - coopRune.s.hp_f);
                  });
                }
              }
              if (prevAliveCount === 1 && aliveCount > 1) {
                const soloRune = runes.find(r => r && r.name === "ê³ ë…í•œ ë¶„ë…¸");
                if (soloRune && soloRune.s.hp_f) {
                  dinos.forEach(d => {
                    if (d.hp > 0) d.hp = Math.max(0, d.hp - soloRune.s.hp_f);
                  });
                }
              }
              aliveDinos = dinos.filter(d => d.hp > 0);
              aliveCount = aliveDinos.length;
              if (aliveCount <= 0) break;
            }
            prevAliveCount = aliveCount;
            let atkF = 0,
              atkP = 0,
              hpF = 0,
              hpP = 0;
            let cRate = 3,
              cDmg = 105;
            runes.forEach(r => {
              if (!r) return;
              let active = (r.name === "í˜‘ë™ ê³µê²©" ? aliveCount >= 5 : (r.name === "ê³ ë…í•œ ë¶„ë…¸" ? aliveCount === 1 : true));
              if (active) {
                if (r.s.atk_f) atkF += r.s.atk_f;
                if (r.s.atk_p) atkP += r.s.atk_p;
                if (r.s.hp_f) hpF += r.s.hp_f;
                if (r.s.hp_p) hpP += r.s.hp_p;
              }
              if (r.name === "ì¹˜ëª…íƒ€ í™•ë¥ ") cRate += r.s.prob;
              if (r.name === "ì¹˜ëª…íƒ€ í”¼í•´") cDmg += r.s.crit_d;
            });
            const currentMaxHp = (bHp + hpF) * (1 + hpP / 100);
            const currentAtk = (bAtk + atkF) * (1 + atkP / 100);
            if (t === 1) {
              initialFullHp = currentMaxHp;
              const sRune = runes.find(r => r && r.name === "ë³´í˜¸ë§‰");
              dinos.forEach(d => {
                d.hp = initialFullHp;
                d.shieldSteps = sRune ? sRune.s.turn : 0;
              });
              aliveDinos = dinos;
            }
            // --- ê³µë£¡ ê³µê²© ì‹œì‘ ---
            for (let d of aliveDinos) {
              d.attackCount++;
              let finalBaseAtk = currentAtk + d.giftAtk;
              const calcDmg = (val) => (Math.random() * 100 < cRate) ? val * (cDmg / 100) : val;
              // í‰íƒ€
              tHp -= calcDmg(finalBaseAtk);
              // ë‚™ë¢°: s.prob(í™•ë¥ ), s.burst_p(ë°ë¯¸ì§€ ë°°ìœ¨)
              const thunder = runes.find(r => r && r.name === "ë‚™ë¢°");
              if (thunder && Math.random() * 100 < thunder.s.prob) {
                tHp -= calcDmg(finalBaseAtk * (thunder.s.burst_p / 100));
              }
              // ë©”í…Œì˜¤: s.prob(í™•ë¥ ), s.burst_p(ë°ë¯¸ì§€ ë°°ìœ¨)
              const meteor = runes.find(r => r && r.name === "ë©”í…Œì˜¤");
              if (meteor && Math.random() * 100 < meteor.s.prob) {
                tHp -= calcDmg(finalBaseAtk * (meteor.s.burst_p / 100));
              }
              // íŠ¸ë¦¬í”Œ ì„íŒ©íŠ¸: s.burst_p(ë°ë¯¸ì§€ ë°°ìœ¨)
              const triple = runes.find(r => r && r.name === "íŠ¸ë¦¬í”Œ ì„íŒ©íŠ¸");
              if (triple && d.attackCount % 3 === 0) {
                tHp -= calcDmg(finalBaseAtk * (triple.s.burst_p / 100));
              }
              // íƒ€ì´íƒ„ ì‚¬ë§ ì²´í¬
              if (tHp <= 0) {
                tHp = 0;
                break;
              }
              // í¡í˜ˆ: s.prob(í™•ë¥ ), s.rec_p(íšŒë³µ ë°°ìœ¨)
              const vRune = runes.find(r => r && r.name === "í¡í˜ˆ");
              if (vRune && Math.random() * 100 < vRune.s.prob) {
                d.hp = Math.min(currentMaxHp, d.hp + (vampBaseAtk * vRune.s.rec_p / 100));
              }
              if (d.giftSteps > 0) {
                d.giftSteps--;
                if (d.giftSteps === 0) d.giftAtk = 0;
              }
            }
            if (tHp <= 0) {
              tHp = 0;
              break;
            }
            // --- ê³µë£¡ ê³µê²© ë ---
            if (t % 3 === 0) {
              let baseTDmg = targetTitan.atk;
              const healRune = runes.find(r => r && r.name === "í");
              const sRune = runes.find(r => r && r.name === "ë³´í˜¸ë§‰");
              const sacrificeRune = runes.find(r => r && r.name === "í¬ìƒ");
              const giftRune = runes.find(r => r && r.name === "ë§ˆì§€ë§‰ ì„ ë¬¼");
              const deathRune = runes.find(r => r && r.name === "ì£½ì„ ì¤€ë¹„");
              for (let d of dinos) {
                if (d.hp > 0) {
                  if (healRune && Math.random() * 100 < healRune.s.prob) d.hp = Math.min(currentMaxHp, d.hp + (currentMaxHp * healRune.s.rec_p / 100));
                  let currentTDmg = baseTDmg;
                  const skin1 = runes.find(r => r && r.name === "ë‹¨ë‹¨í•œ í”¼ë¶€ 1");
                  const skin2 = runes.find(r => r && r.name === "ë‹¨ë‹¨í•œ í”¼ë¶€ 2");
                  const res1 = runes.find(r => r && r.name === "í”¼í•´ ì €í•­ 1");
                  const res2 = runes.find(r => r && r.name === "í”¼í•´ ì €í•­ 2");
                  if (skin1) currentTDmg -= skin1.s.red_f;
                  if (skin2) currentTDmg -= skin2.s.red_f;
                  if (res1 && Math.random() * 100 < res1.s.prob) currentTDmg -= res1.s.red_f;
                  if (res2 && Math.random() * 100 < res2.s.prob) currentTDmg -= res2.s.red_f;
                  currentTDmg = Math.max(0, currentTDmg);
                  if (d.shieldSteps > 0) {
                    currentTDmg = currentTDmg * (1 - (sRune ? sRune.s.red_p : 0) / 100);
                    d.shieldSteps--;
                  }
                  d.hp = Math.max(0, d.hp - currentTDmg);
                  // ì‚¬ë§ ì‹œ ë°œë™ íš¨ê³¼
                  if (d.hp === 0) {
                    if (sacrificeRune && Math.random() * 100 < sacrificeRune.s.prob) {
                      dinos.forEach(target => {
                        if (target.hp > 0) target.hp = Math.min(currentMaxHp, target.hp + (currentMaxHp * sacrificeRune.s.rec_p / 100));
                      });
                    }
                    if (deathRune && Math.random() * 100 < deathRune.s.prob) {
                      tHp -= (currentAtk * deathRune.s.burst_p / 100);
                      if (tHp <= 0) tHp = 0;
                    }
                    if (giftRune && Math.random() * 100 < giftRune.s.prob) {
                      dinos.forEach(target => {
                        if (target.hp > 0) {
                          target.giftAtk += giftRune.s.atk_f;
                          target.giftSteps = giftRune.s.turn;
                        }
                      });
                    }
                  }
                }
              }
              if (tHp <= 0) {
                tHp = 0;
                break;
              }
            }
            // t ë£¨í”„ ë‚´ë¶€ (ê³µë£¡ ê³µê²©/íƒ€ì´íƒ„ ê³µê²© ë¡œì§ ê·¼ì²˜)
            if (isLogEnabled && i === 0) { // ë¡œê·¸ê°€ ì¼œì ¸ ìˆê³ , ì²« ë²ˆì§¸ ë°˜ë³µì¼ ë•Œë§Œ ê¸°ë¡
              detailedLogs.push({
                "ì‹œê°„": t + "ì´ˆ",
                "íƒ€ì´íƒ„HP": Math.floor(tHp).toLocaleString(),
                "ìƒì¡´ê³µë£¡": aliveCount + "ë§ˆë¦¬",
                "ê³µë£¡ìƒíƒœ": dinos.map((d, idx) => ({
                  "ë²ˆí˜¸": idx + 1,
                  "ë‚¨ì€HP": Math.max(0, d.hp).toFixed(0)
                }))
              });
            }
            let tickHpSum = 0;
            let safeFullHp = initialFullHp > 0 ? initialFullHp : 1;
            dinos.forEach(d => tickHpSum += (Math.max(0, d.hp) / safeFullHp) * 100);
            timeSeriesHp[t] += (tickHpSum / maxDino);
            timeSeriesCount[t]++;
            if (tHp <= 0) {
              tHp = 0;
              break;
            }
          }
          totalTitanHp += Math.max(0, tHp);
          totalTime += sessionTime;
          totalDead += dinos.filter(d => d.hp <= 0).length;
          totalDmg += (targetTitan.hp - Math.max(0, tHp));
        }
        completed = end;
        btn.innerText = `ì‹œë®¬ë ˆì´ì…˜ ì¤‘(${completed}/500)...`;
        if (completed < iterations) {
          setTimeout(runBatch, 0);
        } else {
          finalize();
        }
      };
      const finalize = () => {
        const rep = document.getElementById('battleReport');
        rep.style.display = 'block';
        let validTicks = 0,
          totalAvgSum = 0;
        const chartData = [];
        for (let k = 1; k <= limitSec; k++) {
          if (timeSeriesCount[k] > 0) {
            const avg = timeSeriesHp[k] / timeSeriesCount[k];
            if (timeSeriesCount[k] >= iterations * 0.01) {
              chartData.push(avg);
              totalAvgSum += avg;
              validTicks++;
            }
          }
        }
        const finalRollingAvg = totalAvgSum / (validTicks || 1);
        // 2. ê¸°ë³¸ ì •ë³´ ì¶œë ¥
        document.getElementById('repTotalDmg').innerText = Math.floor(totalDmg / iterations).toLocaleString();
        document.getElementById('repTitanHp').innerText = Math.max(0, Math.floor(totalTitanHp / iterations)).toLocaleString();
        const avgSec = totalTime / iterations;
        document.getElementById('repTime').innerText = `${Math.floor(avgSec / 60)}ë¶„ ${Math.floor(avgSec % 60)}ì´ˆ`;
        document.getElementById('repDead').innerText = `${(totalDead / iterations).toFixed(1)}ë§ˆë¦¬`;
        document.getElementById('avgMinHpPer').innerText = "í‰ê·  ìƒì¡´ ì²´ë ¥: " + finalRollingAvg.toFixed(1) + '%';
        // 5. ê·¸ë˜í”„ ê·¸ë¦¬ê¸° í•¨ìˆ˜ í˜¸ì¶œ
        if (chartData.length > 0) {
          drawHpChart(chartData);
        }
        const simulateBtn = document.querySelector('.btn-simulate');
        if (simulateBtn) {
          simulateBtn.disabled = false;
          simulateBtn.innerText = "ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ âš”ï¸";
        }
        if (rep) {
          rep.scrollIntoView({
            behavior: 'smooth',
            block: 'nearest'
          });
        }
        // finalize í•¨ìˆ˜ ëë¶€ë¶„
        if (isLogEnabled && detailedLogs.length > 0) {
          const reportBox = document.getElementById('battleReport');
          // ê¸°ì¡´ ë²„íŠ¼ ì¤‘ë³µ ë°©ì§€
          const oldBtn = document.getElementById('logDownloadBtn');
          if (oldBtn) oldBtn.remove();
          const logBtn = document.createElement('button');
          logBtn.id = 'logDownloadBtn';
          logBtn.innerHTML = "ğŸ“Š ìƒì„¸ ë¡œê·¸(.txt) ë‹¤ìš´ë¡œë“œ";
          logBtn.className = "btn-simulate";
          logBtn.style.cssText = "margin-top:15px; background:#455a64; font-size:14px;";
          logBtn.onclick = () => {
            // í…ìŠ¤íŠ¸ íŒŒì¼ ë‚´ìš© êµ¬ì„±
            let content = "=== ìƒì„¸ ì „íˆ¬ ë¡œê·¸ (1íšŒì°¨) ===\n\n";
            detailedLogs.forEach(entry => {
              content += `[${entry.ì‹œê°„}] íƒ€ì´íƒ„HP: ${entry.íƒ€ì´íƒ„HP} | ìƒì¡´: ${entry.ìƒì¡´ê³µë£¡}\n`;
              entry.ê³µë£¡ìƒíƒœ.forEach(d => {
                content += `  - ${d.ë²ˆí˜¸}ë²ˆ ê³µë£¡ HP: ${d.ë‚¨ì€HP}\n`;
              });
              content += "--------------------------------\n";
            });
            const blob = new Blob([content], {
              type: 'text/plain'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `battle_log_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
          };
          reportBox.appendChild(logBtn);
        }
      };
      runBatch();
    }

    function drawHpChart(data) {
      const canvas = document.getElementById('hpChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      // ë¶€ëª¨ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶¤
      const rect = canvas.parentElement.getBoundingClientRect();
      canvas.width = rect.width - 20;
      canvas.height = rect.height - 20;
      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);
      // ê°€ì´ë“œë¼ì¸ (50% ì ì„ )
      ctx.strokeStyle = 'rgba(255,255,255,0.1)';
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.moveTo(0, h / 2);
      ctx.lineTo(w, h / 2);
      ctx.stroke();
      ctx.setLineDash([]);
      // ì„  ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
      ctx.beginPath();
      ctx.strokeStyle = '#2ecc71';
      ctx.lineWidth = 3;
      ctx.lineJoin = 'round';
      const stepX = w / (data.length - 1);
      data.forEach((val, i) => {
        const x = i * stepX;
        const y = h - (val * h / 100);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();
      // í•˜ë‹¨ ì±„ìš°ê¸°
      ctx.lineTo(w, h);
      ctx.lineTo(0, h);
      const grad = ctx.createLinearGradient(0, 0, 0, h);
      grad.addColorStop(0, 'rgba(46, 204, 113, 0.2)');
      grad.addColorStop(1, 'rgba(46, 204, 113, 0)');
      ctx.fillStyle = grad;
      ctx.fill();
    }

    function getImgUrl(id) {
      return id ? `https://lh3.googleusercontent.com/d/${id}` : "";
    }
  </script>
</body>

</html>
