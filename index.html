<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino Mutant 시뮬레이터 Pro</title>
    <style>
        /* Base Styles */
        body { 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; 
            padding: 20px; 
            background-color: #f8f9fa; 
            color: #333; 
            max-width: 800px; 
            margin: 0 auto; 
            line-height: 1.6; 
        }

        .warning { 
            font-size: 12px; 
            color: #999; 
            text-align: center; 
            margin-bottom: 15px; 
        }

        /* Card Layout */
        .card { 
            background: #ffffff; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
            margin-bottom: 20px; 
            border: 1px solid #eee;
        }

        .input-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
        }

        /* Form Elements */
        label { 
            display: block; 
            font-weight: 600; 
            margin-bottom: 6px; 
            font-size: 13px; 
            color: #555; 
        }

        input, select { 
            padding: 10px 12px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            width: 100%; 
            box-sizing: border-box; 
            font-size: 14px; 
            transition: border-color 0.2s;
        }

        input:focus, select:focus {
            border-color: #2196F3;
            outline: none;
        }

        /* Slot System */
        .slot-container { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 10px; 
            margin: 15px 0; 
        }

        .slot { 
            aspect-ratio: 1; 
            border: 2px dashed #ddd; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: #fafafa; 
            cursor: pointer; 
            overflow: hidden; 
            transition: all 0.2s ease; 
        }

        .slot.active { 
            border: 2px solid #2196F3; 
            background-color: #e3f2fd; 
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.2); 
        }

        .slot img { width: 100%; height: 100%; object-fit: cover; }

        /* Rune Picker & Grid */
        #runePicker { 
            border-top: 1px solid #eee; 
            padding-top: 20px; 
            display: none; 
        }

        .rune-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); 
            gap: 10px; 
            max-height: 400px; 
            overflow-y: auto; 
            padding-right: 5px;
        }

        .rune-item { 
            cursor: pointer; 
            text-align: center; 
            border: 2px solid transparent; 
            padding: 8px; 
            border-radius: 10px; 
            background: #fff; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            transition: transform 0.1s;
        }

        .rune-item:hover { transform: translateY(-2px); }
        .rune-item img { width: 54px; height: 54px; border-radius: 8px; background: #f0f0f0; }
        .rune-item span { font-size: 11px; display: block; margin-top: 5px; font-weight: 500; }

        /* Detail Card */
        .detail-card { 
            background: #fcfcfc; 
            border: 1px solid #eee; 
            padding: 20px; 
            border-radius: 10px; 
            margin-top: 15px; 
        }

        .rune-grade { 
            font-size: 11px; 
            font-weight: bold; 
            padding: 3px 8px; 
            border-radius: 4px; 
            display: inline-block; 
            margin-bottom: 10px; 
        }

        .grade-일반 { background: #E3F2FD; color: #1976D2; }
        .grade-희귀 { background: #E8F5E9; color: #2E7D32; }
        .grade-에픽 { background: #FFFDE7; color: #FBC02D; }
        .grade-유니크 { background: #FFF3E0; color: #EF6C00; }
        .grade-전설 { background: #FFEBEE; color: #C62828; border: 1px solid #FFCDD2; }

        /* Buttons */
        .btn-apply { background: #2196F3; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-remove { background: #f44336; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 8px; }

        /* Results Area */
        .result-box { text-align: center; }
        .status-badge { display: inline-block; padding: 6px 16px; border-radius: 50px; font-weight: bold; margin-top: 15px; font-size: 15px; }
        .pass { background: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }
        .fail { background: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        
        .accum-dmg-box { margin: 15px 0; padding: 12px; background: #fafafa; border: 1px dashed #ccc; border-radius: 8px; }
        .small-select { width: auto !important; padding: 4px 8px !important; font-size: 12px !important; cursor: pointer; }
        
        .text-red { color: #d32f2f; font-weight: bold; }
        .text-green { color: #2e7d32; font-weight: bold; }
    </style>
</head>
<body>

    <div class="warning">※ 본 시뮬레이터는 참고용이며, 게임 내 실제 연산 방식과 차이가 있을 수 있습니다.</div>

    <div class="card">
        <div class="input-grid">
            <div>
                <label>공룡 공격력</label>
                <input type="number" id="baseAtk" value="1" onfocus="this.select()" oninput="autoCalc()">
            </div>
            <div>
                <label>공룡 체력</label>
                <input type="number" id="baseHp" value="10" onfocus="this.select()" oninput="autoCalc()">
            </div>
            <div style="grid-column: span 2;">
                <label>내 공룡 수</label>
                <select id="dinoCount" onchange="autoCalc()">
                    <script>for(let i=1;i<=9;i++) document.write(`<option value="${i}">${i}마리</option>`);</script>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <div style="font-size: 14px; font-weight: bold; margin-bottom: 15px; color: #444; text-align: center;">장착된 룬</div>
        <div class="slot-container">
            <script>for(let i=0;i<5;i++) document.write(`<div class="slot" id="slot${i}" onclick="openPicker(${i})"><small style="color:#ccc">슬롯 ${i+1}</small></div>`);</script>
        </div>

        <div id="runePicker">
            <div class="rune-grid" id="runeGrid"></div>
            
            <div id="detailArea" class="detail-card" style="display:none;">
                <div id="runeGrade" class="rune-grade">등급</div>
                <div style="margin-bottom:12px;">
                    <label>레벨 (1~31)</label>
                    <select id="runeLevel" onchange="updateDetail()"></select>
                </div>
                <div id="runeDesc" style="font-size:13px; color:#444; margin: 10px 0; white-space: pre-line; background:#fff; padding:12px; border-radius:6px; border:1px solid #eee;"></div>
                <button class="btn-apply" onclick="applyToSlot()">룬 장착하기</button>
                <button id="removeBtn" class="btn-remove" onclick="removeRune()">장착 해제</button>
            </div>
        </div>
    </div>

    <div class="card" style="margin-bottom: 10px;">
        <label>타이탄 레벨 선택</label>
        <select id="targetTitan" onchange="autoCalc()"></select>
    </div>

    <div class="card">
        <div id="finalStats" class="result-box">데이터를 입력해 주세요.</div>
    </div>

    <script>
        // 데이터 및 로직 섹션
        const TITAN_DATA = (function() {
            let data = [];
            let currentAtk = 5;
            let currentHp = 2500000;
            for (let lv = 1; lv <= 40; lv++) {
                data.push([lv, currentAtk, currentHp]);
                if (lv < 6) currentAtk += 5;
                else currentAtk += 15;
                if (lv < 4) currentHp += 2500000;
                else if (lv === 4) currentHp += 3125000;
                else currentHp += 3750000;
            }
            return data;
        })();

        const RUNES_DATA = {
            "힐": { grade: "일반", imgId: "10kOU5_hHneBmIpMJ-Hx0FuN-UanR5FDN", desc: "상대 유닛에게 공격당할 때 {prob}% 확률로 내 최대 체력의 {value}%만큼 회복", levels: (function(){ let lv={}; const data=[[5,1.0],[5,1.1],[5,1.2],[5,1.3],[5,1.4],[5,2.0],[5,2.1],[5,2.2],[5,2.3],[5,2.4],[8,2.5],[8,2.6],[8,2.7],[8,2.8],[8,2.9],[8,3.5],[8,3.6],[8,3.7],[8,3.8],[8,3.9],[10,4.0],[10,4.1],[10,4.2],[10,4.3],[10,4.4],[10,5.0],[10,5.1],[10,5.2],[10,5.3],[10,5.4],[13,8.0]]; data.forEach((d,i)=>lv[i+1]={prob:d[0], value:d[1]}); return lv; })() },
            "공격력 증가 1": { grade: "일반", imgId: "1ihowBMqeNvWag_4ou2JLgYilpLGvgnPa", desc: "유닛 공격력 {value} 증가", levels: (function(){ let lv={}; for(let i=1;i<=31;i++) lv[i]={value:i}; return lv; })() },
            "체력 증가 1": { grade: "일반", imgId: "1vNpdtLIozfnNOhjl2-gIMFH33xLmgh3P", desc: "유닛 체력 {value} 증가", levels: (function(){ let lv={}; for(let i=1;i<=31;i++) lv[i]={value:i*25}; return lv; })() },
            "희생": { grade: "일반", imgId: "1Yuy6PLeo7Jx-fAef04PVuqmiZjR_mw64", desc: "사망 시 {prob}% 확률로 같은 타일에 있는 동일 부족 유닛에게 내 최대 체력의 {value}% 회복", levels: (function(){ let lv={}; const probs=[35,35,35,35,35,35,35,35,35,35,40,40,40,40,40,40,40,40,40,40,45,45,45,45,45,45,45,45,45,45,50]; const vals=[10.0,10.5,11.0,11.5,12.0,15.0,15.5,16.0,16.5,17.0,20.0,20.5,21.0,21.5,22.0,25.0,25.5,26.0,26.5,27.0,30.0,30.5,31.0,31.5,32.0,35.0,35.5,36.0,36.5,37.0,45.0]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:vals[i]}); return lv; })() },
            "마지막 선물": { grade: "일반", imgId: "16X52VhA2_Z-UFH6bNFdqA_XkXwPdWZJg", desc: "사망 시 {prob}% 확률로 아군 유닛에게 공격력 {value} 증가 버프 {turn}턴 지속", levels: (function(){ let lv={}; const probs=[40,40,40,40,40,40,40,40,40,40,45,45,45,45,45,45,45,45,45,45,50,50,50,50,50,50,50,50,50,50,60]; const turns=[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4]; for(let i=1;i<=31;i++) lv[i]={prob:probs[i-1], value:14+i, turn:turns[i-1]}; return lv; })() },
            "트리플 임팩트": { grade: "일반", imgId: "1nO4CtfdB_FH7ZvCmL3uj1QPLDJte5mLB", desc: "세 번째 공격마다 내 유닛 공격력의 {value}% 추가 피해", levels: (function(){ let lv={}; const vals=[2.0,2.5,3.0,3.5,4.0,6.0,6.5,7.0,7.5,8.0,10.0,10.5,11.0,11.5,12.0,14.0,14.5,15.0,15.5,16.0,18.0,18.5,19.0,19.5,20.0,22.0,22.5,23.0,23.5,24.0,27.0]; vals.forEach((v,i)=>lv[i+1]={value:v}); return lv; })() },
            "단단한 피부 1": { grade: "일반", imgId: "1oHu7Ep7BwL7Es4dBRVdTyfnSrfd_xIq1", desc: "적 유닛에게 공격당할 때 피해 {value}만큼 감소", levels: (function(){ let lv={}; for(let i=1;i<=31;i++) lv[i]={value:i*2}; return lv; })() },
            "피해 저항 1": { grade: "일반", imgId: "1tBCAdO-UyCTP32gHwEc7TVISeRINsrqa", desc: "피격 시 {prob}% 확률로 피해 {value} 감소", levels: (function(){ let lv={}; const probs=[30,30,30,30,30,35,35,35,35,35,35,35,35,35,35,40,40,40,40,40,40,40,40,40,40,45,45,45,45,45,50]; const vals=[30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:vals[i]}); return lv; })() },
            "보호막": { grade: "일반", imgId: "1-FCajygUymZcpCCxaK7_Scg5NtiPKyiM", desc: "적 유닛에게 공격당할 때 {turn}번의 공격 피해를 {value}% 감소", levels: (function(){ let lv={}; const vals=[1.0,1.5,2.0,2.5,3.0,5.0,5.5,6.0,6.5,7.0,10.0,10.5,11.0,11.5,12.0,13.0,13.5,14.0,14.5,15.0,18.0,18.5,19.0,19.5,20.0,22.0,22.5,23.0,23.5,24.0,28.0]; const turns=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3]; vals.forEach((v,i)=>lv[i+1]={value:v, turn:turns[i]}); return lv; })() },
            "공격력 증가 2": { grade: "희귀", imgId: "1PKky7_H1ZXJNxzZJhByTw7hUclQ0aTRG", desc: "유닛 공격력 {value} 증가", levels: (function(){ let lv={}; for(let i=1;i<=31;i++) lv[i]={value:14+i}; return lv; })() },
            "체력 증가 2": { grade: "희귀", imgId: "1oIkxrSL3mVZo-fHXOv2Ot2Zmmftwpp3H", desc: "유닛 체력 {value} 증가", levels: (function(){ let lv={}; for(let i=1;i<=31;i++) lv[i]={value:350+(i*25)}; return lv; })() },
            "협동 공격": { grade: "희귀", imgId: "1DzFWPRILgHZAF28JrzUzKZQWKCtAN2vR", desc: "내 유닛 5마리 이상일 때 공격력 {atk} 체력 {hp} 증가", levels: (function(){ let lv={}; const atks=[35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,64,66,68,75]; const hps=[875,900,925,950,975,1000,1025,1050,1100,1125,1150,1175,1200,1225,1250,1275,1300,1325,1350,1375,1400,1425,1450,1475,1500,1550,1600,1650,1700,1875]; atks.forEach((a,i)=>lv[i+1]={atk:a, hp:hps[i]}); return lv; })() },
            "고독한 분노": { grade: "희귀", imgId: "1hAyyAwatFwvlKqth4sunU_gURWoTY4ZJ", desc: "내 유닛이 1마리일 때 공격력 {atk} 체력 {hp} 증가", levels: (function(){ let lv={}; for(let i=1;i<=31;i++) lv[i]={atk:14+i, hp:350+(i*25)}; return lv; })() },
            "단단한 피부 2": { grade: "희귀", imgId: "1XfdIrPSz_xm9v1KHB-TArpaRdv47zHLF", desc: "적 유닛에게 공격당할 때 피해 {value}만큼 감소", levels: (function(){ let lv={}; const vals=[30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90]; vals.forEach((v,i)=>lv[i+1]={value:v}); return lv; })() },
            "피해 저항 2": { grade: "희귀", imgId: "13As5kbKRnyJA81fUClKxILhq8P9Rws0c", desc: "피격 시 {prob}% 확률로 피해 {value}만큼 감소", levels: (function(){ let lv={}; const probs=[30,30,30,30,30,35,35,35,35,35,35,35,35,35,35,40,40,40,40,40,40,40,40,40,40,45,45,45,45,45,50]; const vals=[70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,124,128,132,136,150]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:vals[i]}); return lv; })() },
            "치명타 확률": { grade: "에픽", imgId: "1rZUa6JfGfbksXt1qOO32veoEty9er_Bu", desc: "유닛 치명타 확률 {value}% 증가", levels: (function(){ let lv={}; const vals=[13.0,13.3,13.6,13.9,14.2,17.0,17.3,17.6,17.9,18.2,21.0,21.3,21.6,21.9,22.2,25.0,25.5,26.0,26.5,27.0,30.0,30.5,31.0,31.5,32.0,35.0,35.5,36.0,36.5,37.0,40.0]; vals.forEach((v,i)=>lv[i+1]={value:v.toFixed(1)}); return lv; })() },
            "치명타 피해": { grade: "에픽", imgId: "127l8ExJLlQENOySkwk_TiNDLO5gKo7Rm", desc: "유닛 치명타 피해량 {value}% 증가", levels: (function(){ let lv={}; const vals=[20.0,20.5,21.0,21.5,22.0,25.0,25.5,26.0,26.5,27.0,30.0,30.5,31.0,31.5,32.0,35.0,36.0,37.0,38.0,39.0,42.0,43.0,44.0,45.0,46.0,50.0,51.0,52.0,53.0,54.0,60.0]; vals.forEach((v,i)=>lv[i+1]={value:v.toFixed(1)}); return lv; })() },
            "공격력 증가 3": { grade: "에픽", imgId: "1MBbzM8Snw4awmVoS-mBe1ATN_WlkcwqL", desc: "유닛 공격력 {value} 증가", levels: (function(){ let lv={}; const vals=[35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,62,64,66,68,75]; vals.forEach((v,i)=>lv[i+1]={value:v}); return lv; })() },
            "체력 증가 3": { grade: "에픽", imgId: "1r_tPl7V2ydsAD3p_amPfL1d92i-6AFLN", desc: "유닛 체력 {value} 증가", levels: (function(){ let lv={}; const vals=[875,900,925,950,975,1000,1025,1050,1075,1100,1125,1150,1175,1200,1225,1250,1275,1300,1325,1350,1375,1400,1425,1450,1475,1500,1550,1600,1650,1700,1875]; vals.forEach((v,i)=>lv[i+1]={value:v}); return lv; })() },
            "죽을 준비": { grade: "에픽", imgId: "1x77384PZAogZ_hTJeRH1iLXPrOfM5e_g", desc: "사망 시 {prob}% 확률로 적 유닛에게 내 공격력의 {value}% 피해", levels: (function(){ let lv={}; const probs=[80,80,80,80,80,80,80,80,80,80,85,85,85,85,85,85,85,85,85,85,90,90,90,90,90,90,90,90,90,90,100]; const vals=[50,51,52,53,54,60,61,62,63,64,66,67,68,69,70,76,77,78,79,80,82,83,84,85,86,90,91,92,93,94,100]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:vals[i]}); return lv; })() },
            "압축된 힘": { grade: "에픽", imgId: "1aaijjlcR-GjrDeZy4WzBqFN2J7oBiw2C", desc: "공격력 {atk}% 증가, 최대 체력 25% 감소", levels: (function(){ let lv={}; const atks=[15.0,15.2,15.4,15.6,15.8,17.0,17.5,18.0,18.5,19.0,22.0,22.5,23.0,23.5,24.0,27.0,27.5,28.0,28.5,29.0,33.0,33.5,34.0,34.5,35.0,39.0,39.5,40.0,40.5,41.0,45.0]; atks.forEach((a,i)=>lv[i+1]={atk:a.toFixed(1)}); return lv; })() },
            "매머드의 힘": { grade: "에픽", imgId: "14UVrJVEIr5xZghRiG96doS_QhOQ0VxBK", desc: "최대 체력 {hp}% 증가, 공격력 25% 감소", levels: (function(){ let lv={}; const hps=[19.5,20.0,20.5,21.0,21.5,27.0,27.5,28.0,28.5,29.0,34.5,35.5,36.5,37.5,38.5,44.5,45.8,47.0,48.3,49.5,59.5,60.8,62.0,63.3,64.5,79.5,80.8,82.0,83.3,84.5,102.0]; hps.forEach((h,i)=>lv[i+1]={hp:h.toFixed(1)}); return lv; })() },
            "흡혈": { grade: "유니크", imgId: "1wpM4jrjnyShM9jkrWQuleCMRQzqajRg-", desc: "공격 시 {prob}% 확률로 공격력의 {value}% 체력 회복", levels: (function(){ let lv={}; const probs=[15,15,15,15,15,15,15,15,15,15,20,20,20,20,20,20,20,20,20,20,25,25,25,25,25,25,25,25,25,25,30]; const vals=[30,32,34,36,38,45,47,49,51,53,55,57,59,61,63,70,72,74,76,78,80,82,84,86,88,95,97,99,101,103,110]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:vals[i]}); return lv; })() },
            "강타": { grade: "유니크", imgId: "1duFRCFWSfwJIT4FcOfDcJU5t9_sYYSNd", desc: "유닛 공격력 {value}% 증가", levels: (function(){ let lv={}; const vals=[7.0,7.2,7.4,7.6,7.8,10.0,10.2,10.4,10.6,10.8,13.0,13.4,13.8,14.2,14.6,17.0,17.5,18.0,18.5,19.0,23.0,23.5,24.0,24.5,25.0,31.0,31.5,32.0,32.5,33.0,40.0]; vals.forEach((v,i)=>lv[i+1]={value:v.toFixed(1)}); return lv; })() },
            "방어벽": { grade: "유니크", imgId: "19nNX-o2m8lDQfKLe5YXd7JijVf7HK0iI", desc: "유닛 체력 {value}% 증가", levels: (function(){ let lv={}; const vals=[17.5,18.0,18.5,19.0,19.5,25.0,25.5,26.0,26.5,27.0,32.5,33.5,34.5,35.5,36.5,42.5,43.8,45.0,46.3,47.5,57.5,58.8,60.0,61.3,62.5,77.5,78.8,80.0,81.3,82.5,100.0]; vals.forEach((v,i)=>lv[i+1]={value:v.toFixed(1)}); return lv; })() },
            "보스 슬레이어": { grade: "유니크", imgId: "1UaNaWoiuUASIRx62ixYoUTleH-wc_gFI", desc: "보스를 공격할 때 유닛의 공격력 {value}% 증가", levels: (function(){ let lv={}; const vals=[20,22,24,26,28,40,42,44,46,48,60,62,64,66,68,80,83,86,89,92,110,115,120,125,130,150,160,170,180,190,250]; vals.forEach((v,i)=>lv[i+1]={value:v.toFixed(1)}); return lv; })() },
            "메테오": { grade: "전설", imgId: "1fJVyoKiTVH1i0votjXaXuwAbTZjxnM-P", desc: "공격 시 {prob}% 확률로 광역 {value}% 추가 피해\n[패시브] 공/체 {extra}% 증가", levels: (function(){ let lv={}; const probs=[50,50,50,50,50,55,55,55,55,55,55,55,55,55,55,55,55,55,55,55,60,60,60,60,60,65,65,65,65,65,65]; const dmgs=[15,16,17,18,19,20,21,22,23,24,40,41,42,43,44,50,51,52,53,54,65,66,67,68,69,70,71,72,73,74,80]; const extras=[2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,10]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:dmgs[i], extra:extras[i]}); return lv; })() },
            "낙뢰": { grade: "전설", imgId: "1pPUwyTblvZJDbTAPUOJYr8hdUqPTZmy4", desc: "공격 시 {prob}% 확률로 타겟에게 {value}% 추가 피해\n[패시브] 공/체 {extra}% 증가", levels: (function(){ let lv={}; const probs=[40,40,40,40,40,45,45,45,45,45,50,50,50,50,50,50,50,50,50,50,60,60,60,60,60,65,65,65,65,65,65]; const dmgs=[40.0,40.5,41.0,41.5,42.0,50.0,50.5,51.0,51.5,52.0,67.5,68.0,68.5,69.0,69.5,82.5,83.0,83.5,84.0,84.5,90.0,90.5,91.0,91.5,92.0,100.0,100.5,101.0,101.5,102.0,115.0]; const extras=[2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,10]; probs.forEach((p,i)=>lv[i+1]={prob:p, value:dmgs[i], extra:extras[i]}); return lv; })() },
            
            "승리의 함성": { grade: "일반", imgId: "1kdYTPMnC9sHD_xVfJ7KlMEAmepKrI5U3", levels: {} },
            "자연의 포옹": { grade: "일반", imgId: "11shDd_9139ob8f3NJpu51kASPqzfDZTF", levels: {} },
            "파괴자 1": { grade: "일반", imgId: "1gEKQmAPtu3APq91BSK7YlUldIkPQQKV3", levels: {} },
            "강인함 1": { grade: "일반", imgId: "1USRrGEG4SiMnOwYYV_IYy0hllT6fXNhN", levels: {} },
            "부족의 축복 1": { grade: "일반", imgId: "19K30pdy48M0_TW7kR5Iz8Cxbx5NxYVkX", levels: {} },
            "파괴자 2": { grade: "희귀", imgId: "1XWpJQ3PShBg43fHvfVgf1f8t0pDoD5mj", levels: {} },
            "부족의 축복 2": { grade: "희귀", imgId: "1EIJibIbgJ2EXyMhJT59cSWNACb-ROxxv", levels: {} },
            "파괴자 3": { grade: "에픽", imgId: "1sSwqcPHGFhZIR1i-UfwHuU34NvvDPwN2", levels: {} },
            "강인함 2": { grade: "유니크", imgId: "12R07txrHKhMhwoxbE4M-QBw4mxxOUTxf", levels: {} },
            "지진": { grade: "유니크", imgId: "1qH0wEmw_otlxQBBofd-H4kuA2SMKIVKn", levels: {} }
        };

        let state = { slots: [null,null,null,null,null], activeIdx: null, tempRune: null, selectedAccumTime: 10 };
        
        // 초기화
        const titanSel = document.getElementById('targetTitan');
        TITAN_DATA.forEach(t => titanSel.add(new Option(`Lv.${t[0]} (ATK ${t[1]} / HP ${t[2].toLocaleString()})`, t[0])));

        const lvSelect = document.getElementById('runeLevel');
        for(let i=1; i<=31; i++) lvSelect.add(new Option(i + "Lv", i));

        const grid = document.getElementById('runeGrid');
        let separatorAdded = false;

        for (let name in RUNES_DATA) {
            const rune = RUNES_DATA[name];
            if (!separatorAdded && Object.keys(rune.levels).length === 0) {
                const hrContainer = document.createElement('div');
                hrContainer.style.gridColumn = "1 / -1";
                hrContainer.style.margin = "15px 0 10px 0";
                hrContainer.innerHTML = `
                    <hr style="border:0; border-top:1px solid #eee; margin-bottom:10px;">
                    <div style="font-size:11px; color:#999; text-align:center; font-weight:bold;">
                        ⚠️ 아래는 타이탄에 적합하지 않은 룬입니다.
                    </div>
                `;
                grid.appendChild(hrContainer);
                separatorAdded = true;
            }

            const item = document.createElement('div');
            item.className = 'rune-item';
            if (Object.keys(rune.levels).length === 0) item.style.opacity = "0.7";
            
            item.innerHTML = `<img src="https://drive.google.com/thumbnail?id=${rune.imgId}&sz=200"><span>${name}</span>`;
            item.onclick = () => selectRuneFromGrid(name, item);
            grid.appendChild(item);
        }

        function openPicker(idx) {
            if (state.activeIdx === idx && document.getElementById('runePicker').style.display === 'block') {
                state.activeIdx = null;
                document.querySelectorAll('.slot').forEach(slot => slot.classList.remove('active'));
                document.getElementById('runePicker').style.display = 'none';
                return;
            }

            state.activeIdx = idx;
            document.querySelectorAll('.slot').forEach((slot, i) => {
                if(i === idx) slot.classList.add('active');
                else slot.classList.remove('active');
            });

            document.getElementById('runePicker').style.display = 'block';

            if(state.slots[idx]) {
                const currentRune = state.slots[idx];
                state.tempRune = currentRune.name; 
                document.getElementById('runeLevel').value = currentRune.level;
                document.getElementById('removeBtn').style.display = 'block';
                selectRuneFromGrid(currentRune.name);
            } else { 
                state.tempRune = null;
                document.getElementById('removeBtn').style.display = 'none'; 
                document.getElementById('detailArea').style.display = 'none';
                document.querySelectorAll('.rune-item').forEach(i => i.style.borderColor = 'transparent');
            }
        }

        function selectRuneFromGrid(name, el) {
            state.tempRune = name;
            document.querySelectorAll('.rune-item').forEach(i => i.style.borderColor = 'transparent');
            
            if(el) {
                el.style.borderColor = '#2196F3';
            } else {
                const items = document.querySelectorAll('.rune-item');
                items.forEach(item => {
                    if(item.querySelector('span').innerText === name) {
                        item.style.borderColor = '#2196F3';
                    }
                });
            }
            
            const detailArea = document.getElementById('detailArea');
            detailArea.style.display = 'block';
            detailArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            updateDetail();
        }

        function updateDetail() {
            if (!state.tempRune) return;
            
            const lv = document.getElementById('runeLevel').value;
            const data = RUNES_DATA[state.tempRune];
            const gradeEl = document.getElementById('runeGrade');
            
            gradeEl.innerText = `${data.grade} 등급`;
            gradeEl.className = `rune-grade grade-${data.grade}`;
            
            if (!data.levels || Object.keys(data.levels).length === 0) {
                document.getElementById('runeDesc').innerText = "정보를 불러올 수 없습니다.";
                return;
            }

            let d = data.desc;
            const eff = data.levels[lv];
            if (eff) {
                for (let k in eff) {
                    d = d.split(`{${k}}`).join(eff[k]);
                }
            }
            document.getElementById('runeDesc').innerText = d;
        }

        function applyToSlot() {
            const idx = state.activeIdx;
            const lv = document.getElementById('runeLevel').value;
            const runeName = state.tempRune;
            if (!runeName || Object.keys(RUNES_DATA[runeName].levels).length === 0) return;

            state.slots.forEach((s, i) => {
                if (s && s.name === runeName && i !== idx) {
                    state.slots[i] = null;
                    document.getElementById(`slot${i}`).innerHTML = `<small style="color:#ccc">슬롯 ${i+1}</small>`;
                }
            });
            state.slots[idx] = { name: runeName, level: lv, effect: RUNES_DATA[runeName].levels[lv] };
            const slotEl = document.getElementById(`slot${idx}`);
            slotEl.innerHTML = `<img src="https://drive.google.com/thumbnail?id=${RUNES_DATA[runeName].imgId}&sz=200">`;
            slotEl.classList.remove('active');
            document.getElementById('runePicker').style.display = 'none';
            autoCalc();
        }

        function removeRune() {
            state.slots[state.activeIdx] = null;
            const slotEl = document.getElementById(`slot${state.activeIdx}`);
            slotEl.innerHTML = `<small style="color:#ccc">슬롯 ${state.activeIdx+1}</small>`;
            slotEl.classList.remove('active');
            document.getElementById('runePicker').style.display = 'none';
            autoCalc();
        }

        function formatTime(seconds) {
            if (seconds >= 999999) return "무한";
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            let res = "";
            if (h > 0) res += h + "시간 ";
            if (m > 0 || h > 0) res += m + "분 ";
            res += s + "초";
            return res;
        }

function autoCalc() {
    // 1. 기본 데이터 수집
    const bA = Number(document.getElementById('baseAtk').value) || 0;
    const bH = Number(document.getElementById('baseHp').value) || 0;
    const count = Number(document.getElementById('dinoCount').value);
    const titanLv = Number(document.getElementById('targetTitan').value);
    const titanInfo = TITAN_DATA.find(t => t[0] === titanLv);
    
    const titanOriginalAtk = titanInfo[1];
    const titanOriginalHp = titanInfo[2];
    
    // 2. 룬 데이터 정리 (공격/방어/유산 분리)
    let stats = { iA: 0, iH: 0, pA: 0, pH: 0, cProb: 3, cDmg: 5, lifesteal: 0 };
    let attackRunes = []; // 트리플, 낙뢰, 메테오
    let defenseRunes = { fixed: 0, probFixed: [], shield: { rate: 0, turns: 0 }, heal: 0 };
    let deathRunes = { sacrifice: 0, gift: 0, ready: 0 };

    state.slots.forEach(s => {
        if(!s) return;
        const e = s.effect, n = s.name;
        // 스탯 버프 (흡혈에 영향 주는 항목)
        if(n.includes("공격력 증가") && !n.includes("%")) stats.iA += Number(e.value);
        if(n === "강타") stats.pA += parseFloat(e.value);
        if(n === "보스 슬레이어") stats.pA += parseFloat(e.value);
        if(n === "흡혈") stats.lifesteal = (e.prob/100) * (e.value/100); // 기댓값 처리 혹은 시뮬 반영

        // 공격 룬 (흡혈 제외)
        if(n === "트리플 임팩트") attackRunes.push({ type: 'triple', rate: e.value/100 });
        if(n === "낙뢰") attackRunes.push({ type: 'prob', prob: e.prob/100, rate: e.value/100 });
        if(n === "메테오") attackRunes.push({ type: 'prob', prob: e.prob/100, rate: e.value/100 });

        // 방어 룬
        if(n.includes("단단한 피부")) defenseRunes.fixed += Number(e.value);
        if(n.includes("피해 저항")) defenseRunes.probFixed.push({ prob: e.prob/100, value: e.value });
        if(n === "보호막") { defenseRunes.shield.rate = e.value/100; defenseRunes.shield.turns = e.turn; }
        if(n === "힐") defenseRunes.heal = (e.prob/100) * (e.value/100);
    });

    // 3. 시뮬레이션 변수 설정
    const SIM_COUNT = 1000; // 1000번의 전투 시뮬레이션
    let totalWin = 0;
    let totalSurvivalTime = 0;

    // --- 시뮬레이션 루프 (핵심 로직) ---
    for(let i = 0; i < SIM_COUNT; i++) {
        let currentTitanHp = titanOriginalHp;
        let currentDinoHp = (bH + stats.iH) * (1 + stats.pH/100);
        let currentDinoAtk = (bA + stats.iA) * (1 + stats.pA/100); // 버프 포함 공격력
        let shieldActiveTurns = defenseRunes.shield.turns;
        let hitCount = 0;
        let battleTime = 0;

        while(currentDinoHp > 0 && currentTitanHp > 0) {
            battleTime += 1; // 1초 단위 계산 (간략화)

            // [1단계] 공룡 공격 (1초마다)
            hitCount++;
            let damageToTitan = currentDinoAtk; // 흡혈 기준이 되는 공격력
            let extraDamage = 0;

            // 추가 룬 데미지 계산 (흡혈 제외 리스트)
            attackRunes.forEach(rune => {
                if(rune.type === 'triple' && hitCount % 3 === 0) extraDamage += currentDinoAtk * rune.rate;
                if(rune.type === 'prob' && Math.random() < rune.prob) extraDamage += currentDinoAtk * rune.rate;
            });

            currentTitanHp -= (damageToTitan + extraDamage);
            
            // [흡혈] 버프된 공격력 기준으로만 회복
            if(Math.random() < 0.2) { // 흡혈 확률 예시
                currentDinoHp += (damageToTitan * stats.lifesteal); 
            }

            // [2단계] 타이탄 공격 (3초마다)
            if(battleTime % 3 === 0) {
                let damageFromTitan = titanOriginalAtk;
                
                // 1. 정수 차감 (단단한 피부 + 피해 저항)
                damageFromTitan -= defenseRunes.fixed;
                defenseRunes.probFixed.forEach(r => {
                    if(Math.random() < r.prob) damageFromTitan -= r.value;
                });

                // 2. 보호막 (%) 적용
                if(shieldActiveTurns > 0) {
                    damageFromTitan *= (1 - defenseRunes.shield.rate);
                    shieldActiveTurns--;
                }

                damageFromTitan = Math.max(0, damageFromTitan);
                currentDinoHp -= damageFromTitan;

                // 3. 힐 확률 체크
                if(Math.random() < 0.1) currentDinoHp += (bH * 0.05); // 예시 수치
            }
            
            if(battleTime > 3600) break; // 1시간 넘으면 중단
        }
        if(currentTitanHp <= 0) totalWin++;
    }

    // 4. 결과 출력 (UI 업데이트)
    const winRate = (totalWin / SIM_COUNT * 100).toFixed(1);
    document.getElementById('finalStats').innerHTML = `
        <div class="result-box">
            <h3>시뮬레이션 승률: <span class="${winRate > 50 ? 'text-green' : 'text-red'}">${winRate}%</span></h3>
            <p>보호막 적용 횟수: ${defenseRunes.shield.turns}회</p>
            <p>흡혈 적용 기준 공격력: ${Math.floor(currentDinoAtk).toLocaleString()}</p>
        </div>
    `;
}
        
        autoCalc();
    </script>
</body>
</html>

